{"version":3,"sources":["../src/index.ts","../src/agent.negotation.router.ts","../src/Logger.ts","../src/NegotiationService.ts","../src/Profile.ts","../src/Contract.ts","../src/types.ts","../src/DataProvider.ts","../src/Agent.ts","../src/MongoDBProvider.ts","../src/MatchingService.ts","../src/RecommendationService.ts","../src/ContractAgent.ts","../src/ContractAgentHandler.ts","../src/agent.contract.router.ts"],"sourcesContent":["export { default as NegotiationAgentRouter } from './agent.negotation.router';\r\nexport { default as ContractAgentRouter } from './agent.contract.router';\r\n// export { default as ConsentAgentRouter } from './agent.consent.router';\r\n\r\nexport type {\r\n  ProfilePolicy,\r\n  ProfilePreference,\r\n  ProfileRecommendation,\r\n  ProfileMatching,\r\n  ProfileConfigurations,\r\n  SearchCriteria,\r\n  FilterCondition,\r\n  Provider,\r\n  DataProviderConfig,\r\n  ProfileDocument,\r\n} from './types';\r\n\r\nexport { Profile } from './Profile';\r\nexport { ContractAgent } from './ContractAgent';\r\nexport { MongoDBProvider } from './MongoDBProvider';\r\n","import express, { Request, Response, Router } from 'express';\r\nimport { NegotiationService } from './NegotiationService';\r\nimport { Profile } from './Profile';\r\nimport { Policy, ServiceOffering, Contract } from './Contract';\r\nimport { ContractAgent } from './ContractAgent';\r\nimport { Logger } from './Logger';\r\nimport { SearchCriteria, FilterOperator } from './types';\r\nimport { Agent } from './Agent';\r\n\r\nconst router: Router = express.Router();\r\nconst negotiationService = NegotiationService.retrieveService();\r\n\r\nasync function fetchProfileById(profileId: string): Promise<Profile> {\r\n  const criteria: SearchCriteria = {\r\n    conditions: [\r\n      {\r\n        field: 'url',\r\n        operator: FilterOperator.EQUALS,\r\n        value: profileId,\r\n      },\r\n    ],\r\n    threshold: 0,\r\n  };\r\n  const contractAgent = await ContractAgent.retrieveService();\r\n  const profilesHost = Agent.getProfileHost();\r\n  if (!profilesHost) {\r\n    throw new Error('profiles host not set');\r\n  }\r\n  const profiles = await contractAgent.findProfiles(profilesHost, criteria);\r\n  if (profiles.length === 0) {\r\n    throw new Error(`Profile not found for ID: ${profileId}`);\r\n  }\r\n  return new Profile(profiles[0]);\r\n}\r\n\r\nrouter.post(\r\n  '/negotiation/contract/acceptance',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const { profileId, contractData } = req.body;\r\n      const profile = await fetchProfileById(profileId);\r\n      const contract = new Contract(contractData);\r\n      const canAccept = negotiationService.canAcceptContract(profile, contract);\r\n      res.json({ canAccept });\r\n    } catch (error) {\r\n      Logger.error(`Error in contract acceptance check: ${error}`);\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.post(\r\n  '/negotiation/policy/acceptance',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const { profileId, policyData } = req.body;\r\n      const profile = await fetchProfileById(profileId);\r\n      const policy: Policy = policyData;\r\n      const isAcceptable = negotiationService.isPolicyAcceptable(\r\n        profile,\r\n        policy,\r\n      );\r\n      res.json({ isAcceptable });\r\n    } catch (error) {\r\n      Logger.error(`Error in policy acceptance check: ${error}`);\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.post(\r\n  '/negotiation/service/acceptance',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const { profileId, serviceData } = req.body;\r\n      const profile = await fetchProfileById(profileId);\r\n      const serviceOffering: ServiceOffering = serviceData;\r\n      const isAcceptable = negotiationService.isServiceAcceptable(\r\n        profile,\r\n        serviceOffering,\r\n      );\r\n      res.json({ isAcceptable });\r\n    } catch (error) {\r\n      Logger.error(`Error in service acceptance check: ${error}`);\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.post(\r\n  '/negotiation/contract/negotiate',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const { profileId, contractData } = req.body;\r\n      const profile = await fetchProfileById(profileId);\r\n      const contract = new Contract(contractData);\r\n      const negotiationResult = negotiationService.negotiateContract(\r\n        profile,\r\n        contract,\r\n      );\r\n      res.json(negotiationResult);\r\n    } catch (error) {\r\n      Logger.error(`Error in contract negotiation: ${error}`);\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.put(\r\n  '/negotiation/profile/preferences',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const { profileId, preferences } = req.body;\r\n      const profile = await fetchProfileById(profileId);\r\n      negotiationService.updateProfilePreferences(profile, preferences);\r\n      res.json({ message: 'Profile preferences updated successfully.' });\r\n    } catch (error) {\r\n      Logger.error(`Error in updating profile preferences: ${error}`);\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nexport default router;\r\n","import { WriteStream, createWriteStream, mkdirSync } from 'fs';\r\nimport { join } from 'path';\r\nimport { format } from 'util';\r\n\r\n/**\r\n * Represents the log levels for the Logger.\r\n * @typedef {'info' | 'warn' | 'error' | 'header'} LogLevel\r\n */\r\ntype LogLevel = 'info' | 'warn' | 'error' | 'header';\r\n\r\n/**\r\n * Configuration options for the Logger.\r\n * @interface LoggerConfig\r\n * @property {boolean} [preserveLogs] - If true, logs will be preserved and passed to an external callback.\r\n * @property {function(LogLevel, string, string): void} [externalCallback] - A callback function to handle preserved logs.\r\n */\r\ninterface LoggerConfig {\r\n  preserveLogs?: boolean;\r\n  externalCallback?: (\r\n    _level: LogLevel,\r\n    _message: string,\r\n    _timestamp: string,\r\n  ) => void;\r\n}\r\n\r\n// ANSI color codes for console output\r\nconst Colors = {\r\n  reset: '\\x1b[0m',\r\n  info: '\\x1b[32m', // green\r\n  warn: '\\x1b[93m', // yellow\r\n  error: '\\x1b[31m', // red\r\n  header: '\\x1b[36m', // cyan\r\n} as const;\r\n\r\n/**\r\n * Logger class for logging messages to the console and optionally to disk.\r\n */\r\nexport class Logger {\r\n  private static noPrint: boolean = false; // Flag to disable console output\r\n\r\n  private static config: LoggerConfig = {\r\n    preserveLogs: false,\r\n  };\r\n\r\n  /**\r\n   * Configures the logger with the provided options.\r\n   * @param {LoggerConfig} config - The configuration settings for the logger.\r\n   */\r\n  static configure(config: LoggerConfig) {\r\n    this.config = { ...this.config, ...config };\r\n  }\r\n\r\n  /**\r\n   * Formats a log message with a timestamp and color based on the log level.\r\n   * @param {LogLevel} level - The log level for the message.\r\n   * @param {string} message - The message to format.\r\n   * @returns {string} - The formatted log message.\r\n   */\r\n  private static formatMessage(level: LogLevel, message: string): string {\r\n    const now = new Date();\r\n    const year = now.getFullYear();\r\n    const month = String(now.getMonth() + 1).padStart(2, '0');\r\n    const day = String(now.getDate()).padStart(2, '0');\r\n    const hours = String(now.getHours()).padStart(2, '0');\r\n    const minutes = String(now.getMinutes()).padStart(2, '0');\r\n    const seconds = String(now.getSeconds()).padStart(2, '0');\r\n    const timestamp = `${year}-${month}-${day}:${hours}.${minutes}.${seconds}`;\r\n    return `${Colors[level]}${timestamp} [${level.toUpperCase()}]: ${message}${Colors.reset}\\n`;\r\n  }\r\n\r\n  /**\r\n   * Logs a message with the specified log level.\r\n   * @param {LogLevel} level - The log level of the message.\r\n   * @param {string} message - The message to log.\r\n   */\r\n  private static log(level: LogLevel, message: string) {\r\n    const timestamp = new Date().toISOString();\r\n    const formattedMessage = this.formatMessage(level, message);\r\n\r\n    if (!this.noPrint) {\r\n      process.stdout.write(formattedMessage);\r\n    }\r\n\r\n    if (this.config.preserveLogs && this.config.externalCallback) {\r\n      this.config.externalCallback(level, message, timestamp);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Logs an informational message.\r\n   * @param {string | object} message - The message to log, can be a string or an object.\r\n   */\r\n  static info(message: string | object) {\r\n    const msg = typeof message === 'string' ? message : format(message);\r\n    this.log('info', msg);\r\n  }\r\n\r\n  /**\r\n   * Logs a warning message.\r\n   * @param {string | object} message - The message to log, can be a string or an object.\r\n   */\r\n  static warn(message: string | object) {\r\n    const msg = typeof message === 'string' ? message : format(message);\r\n    this.log('warn', msg);\r\n  }\r\n\r\n  /**\r\n   * Logs an error message.\r\n   * @param {string | object} message - The message to log, can be a string or an object.\r\n   */\r\n  static error(message: string | object) {\r\n    const msg = typeof message === 'string' ? message : format(message);\r\n    this.log('error', msg);\r\n  }\r\n\r\n  /**\r\n   * Logs a header message.\r\n   * @param {string | object} message - The message to log, can be a string or an object.\r\n   */\r\n  static header(message: string | object) {\r\n    const msg = typeof message === 'string' ? message : format(message);\r\n    this.log('header', msg);\r\n  }\r\n}\r\n\r\n// Default log path for disk logging\r\nconst DEFAULT_LOG_PATH = join(process.cwd(), 'logs');\r\nlet logStream: WriteStream;\r\n\r\n/**\r\n * Generates a log file name based on the current timestamp.\r\n * @returns {string} - The generated log file name.\r\n */\r\nconst getLogFileName = () => {\r\n  const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\r\n  return `dpcp-${timestamp}.log`;\r\n};\r\n\r\n/**\r\n * Initializes the disk logger by creating the log directory and file.\r\n * @returns {boolean} - True if the logger was successfully initialized, otherwise false.\r\n */\r\nconst initDiskLogger = () => {\r\n  try {\r\n    mkdirSync(DEFAULT_LOG_PATH, { recursive: true });\r\n    const logFile = join(DEFAULT_LOG_PATH, getLogFileName());\r\n    logStream = createWriteStream(logFile, { flags: 'a' });\r\n    return true;\r\n  } catch (err) {\r\n    process.stderr.write(`Failed to create log directory: ${err}\\n`);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * Default callback function for handling logs that should be preserved.\r\n * @param {LogLevel} level - The log level of the message.\r\n * @param {string} message - The message to log.\r\n * @param {string} timestamp - The timestamp of the log message.\r\n */\r\nconst defaultDiskCallback = (\r\n  level: LogLevel,\r\n  message: string,\r\n  timestamp: string,\r\n) => {\r\n  if (!logStream && !initDiskLogger()) {\r\n    return;\r\n  }\r\n  const plainMessage = `${timestamp} [LOGGER][${level.toUpperCase()}]: ${message}\\n`;\r\n  logStream.write(plainMessage);\r\n};\r\n\r\n// Initial configuration of the logger to preserve logs on disk\r\nLogger.configure({\r\n  preserveLogs: true,\r\n  externalCallback: defaultDiskCallback,\r\n});\r\n","import { Profile } from './Profile';\r\nimport { ProfilePreference } from './types';\r\nimport { Contract, Policy, ServiceOffering } from './Contract';\r\nimport { Logger } from './Logger';\r\n\r\nexport class NegotiationService {\r\n  private static instance: NegotiationService;\r\n\r\n  static retrieveService(refresh: boolean = false): NegotiationService {\r\n    if (!NegotiationService.instance || refresh) {\r\n      const instance = new NegotiationService();\r\n      NegotiationService.instance = instance;\r\n    }\r\n    return NegotiationService.instance;\r\n  }\r\n\r\n  /**\r\n   * Checks if a policy is acceptable based on the profile preferences.\r\n   * A policy is acceptable if it matches a profile's allowed policies\r\n   * and has a frequency greater than 0.\r\n   *\r\n   * @param {Profile} profile - The profile to evaluate.\r\n   * @param {Policy} policy - The policy to check.\r\n   * @returns {boolean} - True if acceptable, otherwise false.\r\n   */\r\n  isPolicyAcceptable(profile: Profile, policy: Policy): boolean {\r\n    if (profile.configurations.allowPolicies === false) {\r\n      Logger.info('Policies are not allowed by the profile configurations.');\r\n      return false;\r\n    }\r\n    return profile.preference.some((pref) =>\r\n      pref.policies.some(\r\n        (p) => p.policy === policy.description && p.frequency > 0,\r\n      ),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Checks if a service offering is acceptable based on the profile preferences.\r\n   *\r\n   * @param {Profile} profile - The profile to evaluate.\r\n   * @param {ServiceOffering} serviceOffering - The service offering to check.\r\n   * @returns {boolean} - True if acceptable, otherwise false.\r\n   */\r\n  isServiceAcceptable(\r\n    profile: Profile,\r\n    serviceOffering: ServiceOffering,\r\n  ): boolean {\r\n    return profile.preference.some((pref) =>\r\n      pref.services.includes(serviceOffering.serviceOffering),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Validates if all policies of a service offering are acceptable.\r\n   * A service offering is considered acceptable if:\r\n   * - The service is acceptable to the profile.\r\n   * - All its policies are acceptable to the profile.\r\n   *\r\n   * @param {Profile} profile - The profile to evaluate.\r\n   * @param {ServiceOffering} serviceOffering - The service offering to check.\r\n   * @returns {boolean} - True if acceptable, otherwise false.\r\n   */\r\n  areServicePoliciesAcceptable(\r\n    profile: Profile,\r\n    serviceOffering: ServiceOffering,\r\n  ): boolean {\r\n    return (\r\n      this.isServiceAcceptable(profile, serviceOffering) &&\r\n      serviceOffering.policies.every((policy) =>\r\n        this.isPolicyAcceptable(profile, policy),\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Determines if a contract can be accepted by the profile.\r\n   * A contract is acceptable if:\r\n   * - Its status is 'active'.\r\n   * - All its service offerings and their policies are acceptable.\r\n   *\r\n   * @param {Profile} profile - The profile to evaluate.\r\n   * @param {Contract} contract - The contract to evaluate.\r\n   * @returns {boolean} - True if acceptable, otherwise false.\r\n   */\r\n  canAcceptContract(profile: Profile, contract: Contract): boolean {\r\n    if (contract.status !== 'active') {\r\n      Logger.info('Contract is not active.');\r\n      return false;\r\n    }\r\n    const acceptableServices = contract.serviceOfferings.every(\r\n      (serviceOffering) =>\r\n        this.areServicePoliciesAcceptable(profile, serviceOffering),\r\n    );\r\n    return acceptableServices;\r\n  }\r\n\r\n  /**\r\n   * Updates a profile's preferences by adding new valid preferences.\r\n   * Valid preferences must:\r\n   * - Be neither undefined nor null.\r\n   * - Have policies, services, and ecosystems as arrays.\r\n   */\r\n  updateProfilePreferences(\r\n    profile: Profile,\r\n    preferences: Partial<ProfilePreference>[],\r\n  ): void {\r\n    try {\r\n      const validPreferences = preferences.filter(\r\n        (pref): pref is ProfilePreference =>\r\n          pref !== undefined &&\r\n          pref !== null &&\r\n          Array.isArray(pref.policies) &&\r\n          Array.isArray(pref.services) &&\r\n          Array.isArray(pref.ecosystems),\r\n      );\r\n      profile.preference = [...profile.preference, ...validPreferences];\r\n      Logger.info(`Profile preferences updated for ${profile.url}.`);\r\n    } catch (error) {\r\n      Logger.error(`Failed to update profile preferences: ${error}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Negotiates a contract by checking its compatibility with the profile.\r\n   * Returns detailed information about the acceptability of the contract.\r\n   *\r\n   * @param {Profile} profile - The profile to evaluate.\r\n   * @param {Contract} contract - The contract to negotiate.\r\n   * @returns {object} - Details about contract acceptability.\r\n   */\r\n  negotiateContract(\r\n    profile: Profile,\r\n    contract: Contract,\r\n  ): {\r\n    canAccept: boolean;\r\n    reason?: string;\r\n    unacceptablePolicies?: string[];\r\n    unacceptableServices?: string[];\r\n  } {\r\n    try {\r\n      const unacceptablePolicies: string[] = [];\r\n      const unacceptableServices: string[] = [];\r\n      contract.serviceOfferings.forEach((serviceOffering) => {\r\n        if (!this.isServiceAcceptable(profile, serviceOffering)) {\r\n          unacceptableServices.push(serviceOffering.serviceOffering);\r\n        }\r\n        serviceOffering.policies.forEach((policy) => {\r\n          if (!this.isPolicyAcceptable(profile, policy)) {\r\n            unacceptablePolicies.push(policy.description);\r\n          }\r\n        });\r\n      });\r\n      if (unacceptablePolicies.length > 0 || unacceptableServices.length > 0) {\r\n        return {\r\n          canAccept: false,\r\n          reason: 'Contract contains unacceptable policies or services',\r\n          unacceptablePolicies,\r\n          unacceptableServices,\r\n        };\r\n      }\r\n      if (!this.canAcceptContract(profile, contract)) {\r\n        return {\r\n          canAccept: false,\r\n          reason: 'Contract does not align with profile preferences',\r\n        };\r\n      }\r\n      return { canAccept: true };\r\n    } catch (error) {\r\n      Logger.error(`Negotiation failed: ${error}`);\r\n      return {\r\n        canAccept: false,\r\n        reason: 'An error occurred during negotiation.',\r\n      };\r\n    }\r\n  }\r\n}\r\n","import {\r\n  ProfileConfigurations,\r\n  ProfileRecommendation,\r\n  ProfilePreference,\r\n  ProfileMatching,\r\n} from './types';\r\n\r\nexport type ProfileJSON = Omit<\r\n  Pick<Profile, keyof Profile>,\r\n  'createdAt' | 'updatedAt'\r\n> & {\r\n  createdAt?: string | Date;\r\n  updatedAt?: string | Date;\r\n};\r\n\r\nexport class Profile {\r\n  _id?: string;\r\n  url: string;\r\n  configurations: ProfileConfigurations;\r\n  recommendations: ProfileRecommendation[];\r\n  matching: ProfileMatching[];\r\n  preference: ProfilePreference[];\r\n\r\n  constructor({\r\n    url,\r\n    configurations,\r\n    recommendations,\r\n    matching = [],\r\n    preference = [],\r\n  }: ProfileJSON) {\r\n    this.url = url;\r\n    this.configurations = configurations;\r\n    this.recommendations = recommendations;\r\n    this.matching = matching;\r\n    this.preference = preference;\r\n  }\r\n}\r\n","export interface Participant {\r\n  participant: string;\r\n  role: string;\r\n  signature: string;\r\n  date: string;\r\n}\r\n\r\nexport interface Policy {\r\n  description: string;\r\n  permission: {\r\n    action: string;\r\n    target: string;\r\n    constraint: {\r\n      leftOperand: string;\r\n      operator: string;\r\n      rightOperand: number | string;\r\n    }[];\r\n  }[];\r\n  prohibition: any[];\r\n}\r\n\r\nexport interface ServiceOffering {\r\n  participant: string;\r\n  serviceOffering: string;\r\n  policies: Policy[];\r\n  _id?: string;\r\n}\r\n\r\nexport type ContractJSON = Omit<\r\n  Pick<Contract, keyof Contract>,\r\n  'createdAt' | 'updatedAt'\r\n> & {\r\n  createdAt: string | Date;\r\n  updatedAt: string | Date;\r\n};\r\n\r\nexport class Contract {\r\n  _id?: string;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n  ecosystem: string;\r\n  members: Participant[];\r\n  orchestrator: string;\r\n  purpose: string[];\r\n  revokedMembers: Participant[];\r\n  rolesAndObligations: any[];\r\n  serviceOfferings: ServiceOffering[];\r\n  status: string;\r\n\r\n  constructor({\r\n    createdAt,\r\n    updatedAt,\r\n    ecosystem,\r\n    members,\r\n    orchestrator,\r\n    purpose,\r\n    revokedMembers,\r\n    rolesAndObligations,\r\n    serviceOfferings,\r\n    status,\r\n    _id,\r\n  }: ContractJSON) {\r\n    this._id = _id;\r\n    this.createdAt = new Date(createdAt);\r\n    this.updatedAt = new Date(updatedAt);\r\n    this.ecosystem = ecosystem;\r\n    this.members = members;\r\n    this.orchestrator = orchestrator;\r\n    this.purpose = purpose;\r\n    this.revokedMembers = revokedMembers;\r\n    this.rolesAndObligations = rolesAndObligations;\r\n    this.serviceOfferings = serviceOfferings;\r\n    this.status = status;\r\n  }\r\n}\r\n","import { DataProvider } from 'DataProvider';\r\n\r\nexport interface ProfilePolicy {\r\n  policy: string;\r\n  frequency: number;\r\n}\r\n\r\nexport interface ProfilePreference {\r\n  policies: ProfilePolicy[];\r\n  ecosystems: string[];\r\n  services: string[];\r\n}\r\nexport interface ProfileRecommendation {\r\n  policies: ProfilePolicy[];\r\n  ecosystemContracts: any[];\r\n  services: any[];\r\n}\r\n\r\nexport interface ProfileMatching {\r\n  policies: ProfilePolicy[];\r\n  ecosystemContracts: any[];\r\n  services: any[];\r\n}\r\n\r\nexport interface ProfileConfigurations {\r\n  allowRecommendation: boolean;\r\n  allowPolicies: boolean;\r\n}\r\n\r\nexport interface SearchCriteria {\r\n  conditions: FilterCondition[];\r\n  threshold: number;\r\n  limit?: number;\r\n}\r\n\r\nexport interface FilterCondition {\r\n  field: string;\r\n  operator: FilterOperator;\r\n  value: any;\r\n}\r\n\r\nexport enum FilterOperator {\r\n  IN = 'IN',\r\n  EQUALS = 'EQUALS',\r\n  GT = 'GT',\r\n  LT = 'LT',\r\n  CONTAINS = 'CONTAINS',\r\n  REGEX = 'REGEX',\r\n}\r\n\r\nexport interface Provider {\r\n  source?: string;\r\n  watchChanges?: boolean;\r\n  provider: DataProvider;\r\n  hostsProfiles?: boolean;\r\n}\r\n\r\nexport interface DataProviderConfig {\r\n  source: string;\r\n  url: string;\r\n  dbName: string;\r\n  watchChanges?: boolean;\r\n  hostsProfiles?: boolean;\r\n}\r\n\r\nexport interface ProfileDocument {\r\n  url: string;\r\n  configurations: any;\r\n  recommendations?: any[];\r\n  matching?: any[];\r\n  preference?: any[];\r\n}\r\n\r\nexport namespace CAECode {\r\n  export type Type =\r\n    | 'SERVICE_RETRIEVAL_FAILED'\r\n    | 'PREPARATION_FAILED'\r\n    | 'PROFILE_SEARCH_FAILED'\r\n    | 'PROFILE_SAVE_FAILED';\r\n  export const SERVICE_RETRIEVAL_FAILED: Type = 'SERVICE_RETRIEVAL_FAILED';\r\n  export const PREPARATION_FAILED: Type = 'PREPARATION_FAILED';\r\n  export const PROFILE_SEARCH_FAILED: Type = 'PROFILE_SEARCH_FAILED';\r\n  export const PROFILE_SAVE_FAILED: Type = 'PROFILE_SAVE_FAILED';\r\n}\r\n\r\nexport interface ContractAgentError extends Error {\r\n  code: CAECode.Type;\r\n  context?: unknown;\r\n}\r\n\r\nexport interface DataProviderResult<T> {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: ContractAgentError;\r\n}\r\n\r\nexport interface ProfileUpdateResult {\r\n  success: boolean;\r\n  profileId: string;\r\n  error?: ContractAgentError;\r\n}\r\n\r\nexport type DataChangeEvent = {\r\n  source: string;\r\n  type: 'insert' | 'update' | 'delete';\r\n  documentKey?: { _id: string };\r\n  fullDocument?: unknown;\r\n  updateDescription?: {\r\n    updatedFields: unknown;\r\n    removedFields?: string[];\r\n  };\r\n};\r\n","import { EventEmitter } from 'events';\r\nimport { FilterCondition, SearchCriteria } from './types';\r\n\r\nexport type DataProviderType = { new (...args: any[]): DataProvider };\r\n\r\nexport abstract class DataProvider extends EventEmitter {\r\n  static childType?: DataProviderType;\r\n\r\n  // eslint-disable-next-line no-unused-vars\r\n  constructor(public dataSource: string) {\r\n    super();\r\n  }\r\n  //\r\n\r\n  // eslint-disable-next-line no-unused-vars\r\n  abstract find(criteria: SearchCriteria): Promise<[]>;\r\n  // eslint-disable-next-line no-unused-vars\r\n  abstract create(data: unknown): Promise<unknown>;\r\n  // eslint-disable-next-line no-unused-vars\r\n  abstract delete(id: string): Promise<boolean>;\r\n  // eslint-disable-next-line no-unused-vars\r\n  abstract update(criteria: SearchCriteria, data: unknown): Promise<boolean>;\r\n\r\n  static setChildType(childType: DataProviderType) {\r\n    DataProvider.childType = childType;\r\n  }\r\n\r\n  createInstance(): DataProvider {\r\n    if (!DataProvider.childType) {\r\n      throw new Error('Child type not linked');\r\n    }\r\n    return new DataProvider.childType();\r\n  }\r\n\r\n  async ensureReady(): Promise<void> {}\r\n\r\n  protected abstract makeQuery(\r\n    // eslint-disable-next-line no-unused-vars\r\n    conditions: FilterCondition[],\r\n  ): Record<string, any>;\r\n\r\n  //\r\n  protected notifyDataChange(eventName: string, data: any): void {\r\n    this.emit(eventName, data);\r\n  }\r\n}\r\n","import { Profile, ProfileJSON } from './Profile';\r\nimport { DataProvider } from './DataProvider';\r\nimport * as fs from 'fs';\r\nimport { Logger } from './Logger';\r\nimport {\r\n  SearchCriteria,\r\n  ProfileRecommendation,\r\n  ProfileMatching,\r\n  Provider,\r\n  DataProviderConfig,\r\n  DataChangeEvent,\r\n} from './types';\r\nimport path from 'path';\r\n\r\nexport interface AgentConfig {\r\n  dataProviderConfig: DataProviderConfig[];\r\n}\r\n\r\nexport abstract class Agent {\r\n  private static configPath: string;\r\n  private static profilesHost: string;\r\n\r\n  protected config?: AgentConfig;\r\n  protected dataProviders: Provider[] = [];\r\n\r\n  protected constructor() {\r\n    if (!Agent.configPath) {\r\n      throw new Error('Config path not set');\r\n    }\r\n  }\r\n\r\n  static setProfilesHost(profilesHost: string) {\r\n    Agent.profilesHost = profilesHost;\r\n    if (!Agent.profilesHost) {\r\n      Logger.warn('using default profiles source');\r\n      Agent.profilesHost = 'profiles';\r\n    }\r\n  }\r\n\r\n  static getProfileHost(): string {\r\n    return Agent.profilesHost;\r\n  }\r\n\r\n  static setConfigPath(configPath: string, callerFilePath: string): void {\r\n    const fileDir = path.dirname(callerFilePath);\r\n    const agentConfigPath = path.join(fileDir, configPath);\r\n    Agent.configPath = agentConfigPath;\r\n  }\r\n\r\n  protected setupProviderEventHandlers(): void {\r\n    this.dataProviders.forEach(({ provider, watchChanges }) => {\r\n      if (watchChanges !== false) {\r\n        provider.on('dataInserted', this.handleDataInserted.bind(this));\r\n        provider.on('dataUpdated', this.handleDataUpdated.bind(this));\r\n        provider.on('dataDeleted', this.handleDataDeleted.bind(this));\r\n      }\r\n    });\r\n  }\r\n\r\n  getDataProvider(source: string): DataProvider {\r\n    const dataProvider = this.dataProviders.find(\r\n      (provider) => provider.source === source,\r\n    )?.provider;\r\n\r\n    if (!dataProvider) {\r\n      throw new Error(`DataProvider for source '${source}' not found.`);\r\n    }\r\n\r\n    return dataProvider;\r\n  }\r\n\r\n  // eslint-disable-next-line no-unused-vars\r\n  protected abstract handleDataInserted(data: DataChangeEvent): Promise<void>;\r\n  // eslint-disable-next-line no-unused-vars\r\n  protected abstract handleDataUpdated(data: DataChangeEvent): Promise<void>;\r\n  // eslint-disable-next-line no-unused-vars\r\n  protected abstract handleDataDeleted(data: DataChangeEvent): void;\r\n\r\n  abstract findProfiles(\r\n    // eslint-disable-next-line no-unused-vars\r\n    source: string,\r\n    // eslint-disable-next-line no-unused-vars\r\n    criteria: SearchCriteria,\r\n  ): Promise<Profile[]>;\r\n\r\n  addDataProviders(dataProviders: Provider[]): void {\r\n    if (!dataProviders || dataProviders.length === 0) {\r\n      throw new Error('The dataProviders array cannot be empty.');\r\n    }\r\n    for (const dataProvider of dataProviders) {\r\n      if (!dataProvider.provider) {\r\n        continue;\r\n      }\r\n      dataProvider.source = dataProvider.provider.dataSource;\r\n      if (dataProvider.hostsProfiles && dataProvider.source) {\r\n        Agent.setProfilesHost(dataProvider.source);\r\n      }\r\n    }\r\n    this.dataProviders.push(...dataProviders);\r\n  }\r\n\r\n  protected async addDefaultProviders(): Promise<void> {\r\n    if (!this.config) {\r\n      Logger.warn('No configuration found. No data providers added.');\r\n      return;\r\n    }\r\n    const providerType = DataProvider.childType;\r\n    if (typeof providerType !== 'function') {\r\n      throw new Error('Invalid DataProvider type');\r\n    }\r\n    for (const dpConfig of this.config.dataProviderConfig) {\r\n      try {\r\n        const provider = new providerType(dpConfig);\r\n        await provider.ensureReady();\r\n        const { watchChanges, source, hostsProfiles } = dpConfig;\r\n        this.addDataProviders([\r\n          {\r\n            watchChanges,\r\n            source,\r\n            provider,\r\n            hostsProfiles,\r\n          },\r\n        ]);\r\n      } catch (error) {\r\n        Logger.error(\r\n          `Failed to add data provider for source ${dpConfig.source}: ${(error as Error).message}`,\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  protected loadDefaultConfiguration(): void {\r\n    try {\r\n      const configData = fs.readFileSync(Agent.configPath, 'utf-8');\r\n      this.config = JSON.parse(configData) as AgentConfig;\r\n      Logger.info('Configuration loaded successfully');\r\n    } catch (error) {\r\n      Logger.error(`Failed to load configuration: ${(error as Error).message}`);\r\n      this.config = { dataProviderConfig: [] };\r\n    }\r\n  }\r\n\r\n  getRecommendations(profile: Profile): ProfileRecommendation[] {\r\n    return profile.recommendations;\r\n  }\r\n\r\n  getMatchings(profile: Profile): ProfileMatching[] {\r\n    return profile.matching;\r\n  }\r\n\r\n  protected async createProfileForParticipant(\r\n    participantId: string,\r\n  ): Promise<Profile> {\r\n    try {\r\n      const profileProvider = this.getDataProvider(Agent.profilesHost);\r\n      const newProfileData = {\r\n        url: participantId,\r\n        configurations: {},\r\n        recommendations: [],\r\n        matching: [],\r\n      };\r\n      const profile = await profileProvider.create(newProfileData);\r\n      return new Profile(profile as ProfileJSON);\r\n    } catch (error) {\r\n      Logger.error(`Error creating profile: ${(error as Error).message}`);\r\n      throw new Error('Profile creation failed');\r\n    }\r\n  }\r\n\r\n  protected abstract updateMatchingForProfile(\r\n    // eslint-disable-next-line no-unused-vars\r\n    profile: Profile,\r\n    // eslint-disable-next-line no-unused-vars\r\n    data: unknown,\r\n  ): Promise<void>;\r\n\r\n  protected abstract updateRecommendationForProfile(\r\n    // eslint-disable-next-line no-unused-vars\r\n    profile: Profile,\r\n    // eslint-disable-next-line no-unused-vars\r\n    data: unknown,\r\n  ): Promise<void>;\r\n\r\n  protected abstract enrichProfileWithSystemRecommendations(): Profile;\r\n\r\n  // eslint-disable-next-line no-unused-vars\r\n  protected abstract buildSearchCriteria(sourceEntity: unknown): SearchCriteria;\r\n}\r\n","import {\r\n  Collection,\r\n  Db,\r\n  Document,\r\n  WithId,\r\n  InsertOneResult,\r\n  MongoClient,\r\n  ObjectId,\r\n  MatchKeysAndValues,\r\n} from 'mongodb';\r\nimport { DataProvider } from './DataProvider';\r\nimport {\r\n  FilterOperator,\r\n  SearchCriteria,\r\n  FilterCondition,\r\n  DataProviderConfig,\r\n} from './types';\r\nimport { Logger } from './Logger';\r\n\r\ntype DocumentChangeHandler = (collectionName: string, document: any) => void;\r\n\r\nclass MongoInterceptor {\r\n  private static instance: MongoInterceptor;\r\n  private callbacks: Map<string, DocumentChangeHandler[]>;\r\n\r\n  private constructor() {\r\n    this.callbacks = new Map();\r\n    ['insert', 'update', 'delete'].forEach((op) => {\r\n      this.callbacks.set(op, []);\r\n    });\r\n  }\r\n\r\n  static getInstance(): MongoInterceptor {\r\n    if (!MongoInterceptor.instance) {\r\n      MongoInterceptor.instance = new MongoInterceptor();\r\n    }\r\n    return MongoInterceptor.instance;\r\n  }\r\n\r\n  public addCallback(\r\n    changeType: string,\r\n    callback: DocumentChangeHandler,\r\n  ): void {\r\n    const callbacks = this.callbacks.get(changeType) || [];\r\n    callbacks.push(callback);\r\n    this.callbacks.set(changeType, callbacks);\r\n  }\r\n\r\n  public notifyCallbacks(\r\n    changeType: string,\r\n    collectionName: string,\r\n    document: any,\r\n  ): void {\r\n    const callbacks = this.callbacks.get(changeType) || [];\r\n    callbacks.forEach((callback) => callback(collectionName, document));\r\n  }\r\n}\r\n\r\nexport class MongoDBProvider extends DataProvider {\r\n  private static connections: Map<\r\n    string,\r\n    { db: Db; client: MongoClient } | undefined\r\n  > = new Map();\r\n  private db?: Db;\r\n  private client?: MongoClient;\r\n  private collection!: Collection<Document>;\r\n  private dbName: string;\r\n  private connectionPromise?: Promise<Db>;\r\n\r\n  constructor(config: DataProviderConfig) {\r\n    super(config.source);\r\n    this.dbName = config.dbName;\r\n    this.connectionPromise = this.connectToDatabase(config.url);\r\n  }\r\n\r\n  private async connectToDatabase(url: string): Promise<Db> {\r\n    if (!url) {\r\n      throw new Error('Database URL is required');\r\n    }\r\n\r\n    const connectionKey = `${url}:${this.dbName}`;\r\n    const existingConnection = MongoDBProvider.connections.get(connectionKey);\r\n    if (existingConnection) {\r\n      Logger.info('Reusing existing MongoDB connection');\r\n      this.db = existingConnection.db;\r\n      this.client = existingConnection.client;\r\n      return this.db;\r\n    }\r\n\r\n    try {\r\n      const client = await MongoClient.connect(url);\r\n      const db = client.db(this.dbName);\r\n\r\n      Logger.info('MongoDB connected successfully');\r\n      this.db = db;\r\n      this.client = client;\r\n\r\n      MongoDBProvider.connections.set(connectionKey, { db, client });\r\n      return db;\r\n    } catch (error) {\r\n      Logger.error(`Error connecting to MongoDB: ${(error as Error).message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  public static async disconnectFromDatabase(\r\n    url: string,\r\n    dbName: string,\r\n  ): Promise<void> {\r\n    const connectionKey = `${url}:${dbName}`;\r\n    const existingConnection = MongoDBProvider.connections.get(connectionKey);\r\n\r\n    if (existingConnection) {\r\n      try {\r\n        await existingConnection.client.close();\r\n        MongoDBProvider.connections.set(connectionKey, undefined);\r\n        Logger.info(`MongoDB connection for ${connectionKey} closed`);\r\n      } catch (error) {\r\n        Logger.error(`Error during disconnect: ${(error as Error).message}`);\r\n      }\r\n    } else {\r\n      Logger.warn(`No active connection found for ${connectionKey}`);\r\n    }\r\n  }\r\n\r\n  async ensureReady(): Promise<void> {\r\n    await this.connectionPromise;\r\n    this.collection = MongoDBProvider.createCollectionProxy(\r\n      this.db!.collection(this.dataSource),\r\n    );\r\n    this.setupCallbacks();\r\n  }\r\n\r\n  private static createCollectionProxy(collection: Collection): Collection {\r\n    const interceptor = MongoInterceptor.getInstance();\r\n    const handler = {\r\n      get(target: Collection, prop: string | symbol): any {\r\n        const original = target[prop as keyof Collection];\r\n        if (typeof original !== 'function') return original;\r\n\r\n        const nonAsyncMethods = ['find', 'aggregate'];\r\n\r\n        if (nonAsyncMethods.includes(prop as string)) {\r\n          return function (this: Collection, ...args: any[]) {\r\n            return (original as Function).call(target, ...args);\r\n          };\r\n        }\r\n\r\n        return async function (this: any, ...args: any[]) {\r\n          const method = original as (...args: any[]) => Promise<any>;\r\n          const result = await method.apply(target, args);\r\n\r\n          if (prop === 'insertOne') {\r\n            interceptor.notifyCallbacks('insert', collection.collectionName, {\r\n              fullDocument: args[0],\r\n              insertedId: result.insertedId,\r\n              acknowledged: result.acknowledged,\r\n            });\r\n          } else if (prop === 'insertMany') {\r\n            interceptor.notifyCallbacks('insert', collection.collectionName, {\r\n              fullDocuments: args[0],\r\n              insertedIds: result.insertedIds,\r\n              acknowledged: result.acknowledged,\r\n            });\r\n          } else if (prop === 'updateOne' || prop === 'updateMany') {\r\n            interceptor.notifyCallbacks('update', collection.collectionName, {\r\n              filter: args[0],\r\n              update: args[1],\r\n              result,\r\n            });\r\n          } else if (prop === 'deleteOne' || prop === 'deleteMany') {\r\n            interceptor.notifyCallbacks('delete', collection.collectionName, {\r\n              filter: args[0],\r\n              result,\r\n            });\r\n          }\r\n\r\n          return result;\r\n        };\r\n      },\r\n    };\r\n\r\n    return new Proxy(collection, handler);\r\n  }\r\n\r\n  private setupCallbacks(): void {\r\n    const interceptor = MongoInterceptor.getInstance();\r\n\r\n    interceptor.addCallback('insert', (collectionName, data) => {\r\n      if (collectionName === this.dataSource) {\r\n        this.notifyDataChange('dataInserted', {\r\n          fullDocument: data.fullDocument,\r\n          fullDocuments: data.fullDocuments,\r\n          source: this.dataSource,\r\n        });\r\n      }\r\n    });\r\n\r\n    interceptor.addCallback('update', (collectionName, data) => {\r\n      if (collectionName === this.dataSource) {\r\n        this.notifyDataChange('dataUpdated', {\r\n          documentKey: { _id: data.filter._id },\r\n          updateDescription: { updatedFields: data.update.$set || {} },\r\n          source: this.dataSource,\r\n        });\r\n      }\r\n    });\r\n\r\n    interceptor.addCallback('delete', (collectionName, data) => {\r\n      if (collectionName === this.dataSource) {\r\n        this.notifyDataChange('dataDeleted', {\r\n          documentKey: { _id: data.filter._id },\r\n          source: this.dataSource,\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  protected makeQuery(conditions: FilterCondition[]): Record<string, any> {\r\n    return conditions.reduce((query, condition) => {\r\n      switch (condition.operator) {\r\n        case FilterOperator.IN:\r\n          return {\r\n            ...query,\r\n            [condition.field]: { $in: condition.value },\r\n          };\r\n        case FilterOperator.EQUALS:\r\n          return {\r\n            ...query,\r\n            [condition.field]: condition.value,\r\n          };\r\n        case FilterOperator.GT:\r\n          return {\r\n            ...query,\r\n            [condition.field]: { $gt: condition.value },\r\n          };\r\n        case FilterOperator.LT:\r\n          return {\r\n            ...query,\r\n            [condition.field]: { $lt: condition.value },\r\n          };\r\n        case FilterOperator.CONTAINS:\r\n          return {\r\n            ...query,\r\n            [condition.field]: {\r\n              $in: Array.isArray(condition.value)\r\n                ? condition.value\r\n                : [condition.value],\r\n            },\r\n          };\r\n        case FilterOperator.REGEX:\r\n          return {\r\n            ...query,\r\n            [condition.field]: {\r\n              $in: Array.isArray(condition.value)\r\n                ? condition.value.map((val) => new RegExp(val, 'i'))\r\n                : [new RegExp(condition.value, 'i')],\r\n            },\r\n          };\r\n        default:\r\n          throw new Error(`Unsupported operator: ${condition.operator}`);\r\n      }\r\n    }, {});\r\n  }\r\n\r\n  async create(data: Document): Promise<WithId<Document>> {\r\n    try {\r\n      const result: InsertOneResult<Document> =\r\n        await this.collection.insertOne(data);\r\n      if (!result.acknowledged) {\r\n        throw new Error('Document insertion was not acknowledged');\r\n      }\r\n      return { ...data, _id: result.insertedId };\r\n    } catch (error) {\r\n      Logger.info(\r\n        `Error during document insertion: ${(error as Error).message}`,\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async delete(id: string): Promise<boolean> {\r\n    try {\r\n      const result = await this.collection.deleteOne({ _id: new ObjectId(id) });\r\n\r\n      if (result.deletedCount === 0) {\r\n        Logger.warn(`No document found with id: ${id}`);\r\n        return false;\r\n      }\r\n\r\n      Logger.info(`Document with id: ${id} successfully deleted`);\r\n      return true;\r\n    } catch (error) {\r\n      Logger.error(\r\n        `Error during document deletion: ${(error as Error).message}`,\r\n      );\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async find(criteria: SearchCriteria): Promise<[]> {\r\n    const query = this.makeQuery(criteria.conditions);\r\n    const data = (await this.collection\r\n      .find(query)\r\n      .limit(criteria.limit || 0)\r\n      .toArray()) as [];\r\n    return data;\r\n  }\r\n\r\n  async update(criteria: SearchCriteria, data: unknown): Promise<boolean> {\r\n    try {\r\n      const updateData = data as MatchKeysAndValues<Document>;\r\n      const query = this.makeQuery(criteria.conditions);\r\n      const result = await this.collection.updateOne(query, {\r\n        $set: updateData,\r\n      });\r\n      if (result.matchedCount === 0) {\r\n        Logger.warn(`No document found matching the criteria`);\r\n        return false;\r\n      }\r\n      if (result.modifiedCount === 0) {\r\n        Logger.info(`No changes made to document`);\r\n        return false;\r\n      }\r\n      Logger.info(`Document successfully updated`);\r\n      return true;\r\n    } catch (error) {\r\n      Logger.error(`Error during document update: ${(error as Error).message}`);\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n","import { Profile } from './Profile';\r\nimport { Logger } from './Logger';\r\nimport { Contract } from './Contract';\r\n\r\nexport class MatchingService {\r\n  private static instance: MatchingService;\r\n\r\n  static retrieveService(refresh: boolean = false): MatchingService {\r\n    if (!MatchingService.instance || refresh) {\r\n      const instance = new MatchingService();\r\n      MatchingService.instance = instance;\r\n    }\r\n    return MatchingService.instance;\r\n  }\r\n\r\n  async updateProfile(profile: Profile, data: unknown): Promise<void> {\r\n    try {\r\n      const contract: Contract = data as Contract;\r\n\r\n      const otherParticipantsServices = contract.serviceOfferings.filter(\r\n        (service) => service.participant !== profile.url,\r\n      );\r\n\r\n      if (!otherParticipantsServices.length) return;\r\n\r\n      const currentRecommendation = profile.recommendations[0];\r\n      if (!currentRecommendation) {\r\n        Logger.error('No recommendations available to compare against.');\r\n        return;\r\n      }\r\n\r\n      let matchingEntry = profile.matching[0];\r\n      if (!matchingEntry) {\r\n        matchingEntry = {\r\n          policies: [],\r\n          ecosystemContracts: [],\r\n          services: [],\r\n        };\r\n        profile.matching.push(matchingEntry);\r\n      }\r\n\r\n      otherParticipantsServices.forEach((service) => {\r\n        service.policies?.forEach((policy) => {\r\n          const matchingPolicy = currentRecommendation.policies.find(\r\n            (recPolicy) => recPolicy.policy === policy.description,\r\n          );\r\n\r\n          if (matchingPolicy) {\r\n            const existingMatchingPolicy = matchingEntry.policies.find(\r\n              (mp) => mp.policy === policy.description,\r\n            );\r\n            if (existingMatchingPolicy) {\r\n              existingMatchingPolicy.frequency += 1;\r\n            } else {\r\n              matchingEntry.policies.push({\r\n                policy: policy.description,\r\n                frequency: 1,\r\n              });\r\n            }\r\n          }\r\n        });\r\n\r\n        const matchingService = currentRecommendation.services.find(\r\n          (recService) =>\r\n            recService.serviceOffering === service.serviceOffering,\r\n        );\r\n\r\n        if (matchingService) {\r\n          const existingMatchingService = matchingEntry.services.find(\r\n            (ms) => ms.serviceOffering === service.serviceOffering,\r\n          );\r\n          if (existingMatchingService) {\r\n            existingMatchingService.frequency += 1;\r\n          } else {\r\n            matchingEntry.services.push({\r\n              serviceOffering: service.serviceOffering,\r\n              frequency: 1,\r\n            });\r\n          }\r\n        }\r\n      });\r\n\r\n      if (!matchingEntry.ecosystemContracts.includes(contract._id)) {\r\n        matchingEntry.ecosystemContracts.push(contract._id);\r\n      }\r\n\r\n      profile.matching[0] = matchingEntry;\r\n    } catch (error) {\r\n      Logger.error(\r\n        `Profile matching update failed: ${(error as Error).message}`,\r\n      );\r\n    }\r\n  }\r\n}\r\n","import { Profile } from './Profile';\r\nimport { Logger } from './Logger';\r\nimport { Contract } from './Contract';\r\n\r\nexport class RecommendationService {\r\n  private static instance: RecommendationService;\r\n\r\n  static retrieveService(refresh: boolean = false): RecommendationService {\r\n    if (!RecommendationService.instance || refresh) {\r\n      const instance = new RecommendationService();\r\n      RecommendationService.instance = instance;\r\n    }\r\n    return RecommendationService.instance;\r\n  }\r\n\r\n  async updateProfile(profile: Profile, data: unknown): Promise<void> {\r\n    try {\r\n      const contract: Contract = data as Contract;\r\n\r\n      const newPolicyDescriptions =\r\n        this.collectPolicyDescriptionsForParticipant(contract, profile.url);\r\n      const newServiceOfferings = this.collectServiceOfferingsForParticipant(\r\n        contract,\r\n        profile.url,\r\n      );\r\n      const contractId = contract._id;\r\n\r\n      let recommendation = profile.recommendations[0];\r\n\r\n      if (!recommendation) {\r\n        recommendation = {\r\n          policies: [],\r\n          ecosystemContracts: [],\r\n          services: [],\r\n        };\r\n        profile.recommendations.push(recommendation);\r\n      }\r\n\r\n      newPolicyDescriptions.forEach((newPolicyDescription) => {\r\n        const existingPolicy = recommendation.policies?.find(\r\n          (p) => p.policy === newPolicyDescription,\r\n        );\r\n\r\n        if (existingPolicy) {\r\n          existingPolicy.frequency += 1;\r\n        } else {\r\n          recommendation.policies = recommendation.policies || [];\r\n          recommendation.policies.push({\r\n            policy: newPolicyDescription,\r\n            frequency: 1,\r\n          });\r\n        }\r\n      });\r\n\r\n      if (\r\n        contractId &&\r\n        !recommendation.ecosystemContracts.includes(contractId)\r\n      ) {\r\n        recommendation.ecosystemContracts.push(contractId);\r\n      }\r\n\r\n      newServiceOfferings.forEach((newServiceOffering) => {\r\n        const existingService = recommendation.services?.find(\r\n          (s) => s.serviceOffering === newServiceOffering,\r\n        );\r\n\r\n        if (existingService) {\r\n          existingService.frequency += 1;\r\n        } else {\r\n          recommendation.services = recommendation.services || [];\r\n          recommendation.services.push({\r\n            serviceOffering: newServiceOffering,\r\n            frequency: 1,\r\n          });\r\n        }\r\n      });\r\n\r\n      profile.recommendations[0] = recommendation;\r\n    } catch (error) {\r\n      Logger.error(\r\n        `Profile recommendation update failed: ${(error as Error).message}`,\r\n      );\r\n    }\r\n  }\r\n\r\n  private collectPolicyDescriptionsForParticipant(\r\n    contract: Contract,\r\n    participantUrl: string,\r\n  ): string[] {\r\n    const descriptions = new Set<string>();\r\n\r\n    contract.serviceOfferings?.forEach((service) => {\r\n      if (service.participant === participantUrl) {\r\n        service.policies?.forEach((policy) => {\r\n          if (policy?.description) {\r\n            descriptions.add(policy.description);\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    return Array.from(descriptions);\r\n  }\r\n\r\n  private collectServiceOfferingsForParticipant(\r\n    contract: Contract,\r\n    participantUrl: string,\r\n  ): string[] {\r\n    const services = new Set<string>();\r\n\r\n    contract.serviceOfferings?.forEach((service) => {\r\n      if (service.participant === participantUrl && service.serviceOffering) {\r\n        services.add(service.serviceOffering);\r\n      }\r\n    });\r\n\r\n    return Array.from(services);\r\n  }\r\n}\r\n","import { Profile, ProfileJSON } from './Profile';\r\nimport {\r\n  FilterCondition,\r\n  FilterOperator,\r\n  ProfileDocument,\r\n  SearchCriteria,\r\n  ContractAgentError,\r\n  DataChangeEvent,\r\n  CAECode,\r\n} from './types';\r\nimport { Agent } from './Agent';\r\nimport { Contract } from './Contract';\r\nimport { Logger } from './Logger';\r\nimport { DataProvider, DataProviderType } from './DataProvider';\r\nimport { MongoDBProvider } from './MongoDBProvider';\r\nimport { MatchingService } from './MatchingService';\r\nimport { RecommendationService } from './RecommendationService';\r\n\r\n/**\r\n * ContractAgent class handles contract-related operations and profile management\r\n * @extends Agent\r\n */\r\nexport class ContractAgent extends Agent {\r\n  private static instance: ContractAgent | null = null;\r\n\r\n  private constructor() {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * Prepares the ContractAgent instance by loading configuration and setting up providers\r\n   * @throws {ContractAgentError} If preparation fails\r\n   */\r\n  async prepare(): Promise<void> {\r\n    try {\r\n      this.loadDefaultConfiguration();\r\n      await this.addDefaultProviders();\r\n      this.setupProviderEventHandlers();\r\n    } catch (error) {\r\n      const agentError: ContractAgentError = {\r\n        name: 'PreparationError',\r\n        message: `Failed to prepare ContractAgent: ${(error as Error).message}`,\r\n        code: CAECode.PREPARATION_FAILED,\r\n      };\r\n      Logger.error(agentError.message);\r\n      throw agentError;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Retrieves or creates a ContractAgent instance\r\n   * @param dataProviderType - Type of data provider to use\r\n   * @param refresh - Whether to force create a new instance\r\n   * @returns Promise<ContractAgent>\r\n   */\r\n  static async retrieveService(\r\n    dataProviderType: DataProviderType = MongoDBProvider,\r\n    refresh: boolean = false,\r\n  ): Promise<ContractAgent> {\r\n    try {\r\n      if (!ContractAgent.instance || refresh) {\r\n        DataProvider.setChildType(dataProviderType);\r\n        const instance = new ContractAgent();\r\n        await instance.prepare();\r\n        ContractAgent.instance = instance;\r\n      }\r\n      return ContractAgent.instance;\r\n    } catch (error) {\r\n      const serviceError: ContractAgentError = {\r\n        name: 'ServiceRetrievalError',\r\n        message: `Failed to retrieve ContractAgent service: ${(error as Error).message}`,\r\n        code: CAECode.SERVICE_RETRIEVAL_FAILED,\r\n      };\r\n      Logger.error(serviceError.message);\r\n      throw serviceError;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Enriches a profile with system recommendations\r\n   * @throws {ContractAgentError} Method not implemented\r\n   */\r\n  protected enrichProfileWithSystemRecommendations(): Profile {\r\n    throw new Error('Method not implemented.');\r\n  }\r\n\r\n  /**\r\n   * Builds search criteria based on contract policies\r\n   * @param contract - Contract instance to extract policies from\r\n   * @returns SearchCriteria\r\n   */\r\n  protected buildSearchCriteria(contract: Contract): SearchCriteria {\r\n    const policies: string[] = contract.serviceOfferings\r\n      .map((offering) => offering.policies.map((policy) => policy.description))\r\n      .flat();\r\n\r\n    return {\r\n      conditions: [\r\n        {\r\n          field: 'recommendations.policies.policy',\r\n          operator: FilterOperator.REGEX,\r\n          value: policies,\r\n        },\r\n      ],\r\n      threshold: 0.7,\r\n      limit: 100,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Finds profiles based on given criteria from a specific source\r\n   * @param source - Data source identifier\r\n   * @param criteria - Search criteria\r\n   * @returns Promise<Profile[]>\r\n   */\r\n  async findProfiles(\r\n    source: string,\r\n    criteria: SearchCriteria,\r\n  ): Promise<Profile[]> {\r\n    try {\r\n      const dataProvider = this.getDataProvider(source);\r\n      if (!dataProvider) {\r\n        throw new Error(`Data provider not found for source: ${source}`);\r\n      }\r\n\r\n      const results: ProfileDocument[] = await dataProvider.find(criteria);\r\n      return results.map((result) => {\r\n        const profileData: ProfileJSON = {\r\n          url: result.url,\r\n          configurations: result.configurations,\r\n          recommendations: result.recommendations || [],\r\n          matching: result.matching || [],\r\n          preference: result.preference || [],\r\n        };\r\n        return new Profile(profileData);\r\n      });\r\n    } catch (error) {\r\n      const searchError: ContractAgentError = {\r\n        name: 'ProfileSearchError',\r\n        message: `Failed to find profiles: ${(error as Error).message}`,\r\n        code: CAECode.PROFILE_SEARCH_FAILED,\r\n        context: { source, criteria },\r\n      };\r\n      Logger.error(searchError.message);\r\n      throw searchError;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Saves a profile to a specified data source\r\n   * @param source - Data source identifier\r\n   * @param criteria - Search criteria used to find the profile to update\r\n   * @param profile - Profile to be saved\r\n   * @returns Promise<boolean> - Indicates successful save operation\r\n   */\r\n  async saveProfile(\r\n    source: string,\r\n    criteria: SearchCriteria,\r\n    profile: Profile,\r\n  ): Promise<boolean> {\r\n    try {\r\n      const dataProvider = this.getDataProvider(source);\r\n      if (!dataProvider) {\r\n        throw new Error(`Data provider not found for source: ${source}`);\r\n      }\r\n      const profileDocument: ProfileDocument = {\r\n        url: profile.url,\r\n        configurations: profile.configurations,\r\n        recommendations: profile.recommendations || [],\r\n        matching: profile.matching || [],\r\n        preference: profile.preference || [],\r\n      };\r\n      const updateResult = await dataProvider.update(criteria, profileDocument);\r\n      if (!updateResult) {\r\n        Logger.warn(\r\n          `No profile found matching criteria to update for source: ${source}`,\r\n        );\r\n        return false;\r\n      }\r\n      Logger.info(`Profile saved successfully to source: ${source}`);\r\n      return true;\r\n    } catch (error) {\r\n      const saveError: ContractAgentError = {\r\n        name: 'ProfileSaveError',\r\n        message: `Failed to save profile: ${(error as Error).message}`,\r\n        code: CAECode.PROFILE_SAVE_FAILED,\r\n        context: { source, profile },\r\n      };\r\n      Logger.error(saveError.message);\r\n      throw saveError;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Finds profiles across all configured providers\r\n   * @param criteria - Search criteria\r\n   * @returns Promise<Profile[]>\r\n   */\r\n  async findProfilesAcrossProviders(\r\n    criteria: SearchCriteria,\r\n  ): Promise<Profile[]> {\r\n    const allProfiles: Profile[] = [];\r\n\r\n    if (!this.config) {\r\n      throw new Error('Configuration is not initialized');\r\n    }\r\n\r\n    Logger.info(\r\n      `Searching across data sources: ${this.config.dataProviderConfig\r\n        .map((config) => config.source)\r\n        .join(', ')}`,\r\n    );\r\n\r\n    for (const dataProvider of this.dataProviders) {\r\n      const { source } = dataProvider;\r\n      if (!source) {\r\n        throw new Error('Provider source is undefined');\r\n      }\r\n\r\n      const profiles = await this.findProfiles(source, criteria);\r\n      allProfiles.push(...profiles);\r\n    }\r\n\r\n    return allProfiles;\r\n  }\r\n\r\n  /**\r\n   * Updates profiles based on contract changes\r\n   * @param contract - Contract instance\r\n   * @returns Promise<void>\r\n   */\r\n  private async updateProfileFromContractChange(\r\n    contract: Contract,\r\n  ): Promise<void> {\r\n    if (!contract) {\r\n      throw new Error('Contract is undefined');\r\n    }\r\n    await this.updateProfilesForMembers(contract);\r\n    await this.updateProfilesForServiceOfferings(contract);\r\n    await this.updateProfileForOrchestrator(contract);\r\n  }\r\n\r\n  /**\r\n   * Updates profiles for all contract members\r\n   * @param contract - Contract instance\r\n   */\r\n  private async updateProfilesForMembers(contract: Contract): Promise<void> {\r\n    for (const member of contract.members) {\r\n      await this.updateProfile(member.participant, contract);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates profiles for all service offerings\r\n   * @param contract - Contract instance\r\n   */\r\n  private async updateProfilesForServiceOfferings(\r\n    contract: Contract,\r\n  ): Promise<void> {\r\n    for (const offering of contract.serviceOfferings) {\r\n      await this.updateProfile(offering.participant, contract);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates profile for contract orchestrator\r\n   * @param contract - Contract instance\r\n   */\r\n  private async updateProfileForOrchestrator(\r\n    contract: Contract,\r\n  ): Promise<void> {\r\n    await this.updateProfile(contract.orchestrator, contract);\r\n  }\r\n\r\n  /**\r\n   * Updates a single profile\r\n   * @param participantId - Participant identifier\r\n   * @param contract - Contract instance\r\n   */\r\n  private async updateProfile(\r\n    participantId: string,\r\n    contract: Contract,\r\n  ): Promise<void> {\r\n    try {\r\n      const profileProvider = this.dataProviders.find(\r\n        (dataProvider) => dataProvider.source === 'profiles',\r\n      );\r\n\r\n      if (!profileProvider) {\r\n        throw new Error('Profile DataProvider not found');\r\n      }\r\n\r\n      const conditions: FilterCondition = {\r\n        field: 'url',\r\n        operator: FilterOperator.EQUALS,\r\n        value: participantId,\r\n      };\r\n      const criteria: SearchCriteria = {\r\n        conditions: [conditions],\r\n        threshold: 0,\r\n      };\r\n\r\n      const source = profileProvider.source;\r\n      if (!source) {\r\n        throw new Error('Provider \"source\" is undefined');\r\n      }\r\n\r\n      const profiles = await this.findProfiles(source, criteria);\r\n      const profile =\r\n        profiles[0] ?? (await this.createProfileForParticipant(participantId));\r\n\r\n      await this.updateRecommendationForProfile(profile, contract);\r\n      await this.updateMatchingForProfile(profile, contract);\r\n    } catch (error) {\r\n      Logger.error(`Update profile failed: ${(error as Error).message}`);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles inserted data events\r\n   * @param data - Data change event\r\n   */\r\n  protected async handleDataInserted(data: DataChangeEvent): Promise<void> {\r\n    if (data.source === 'contracts' && data.fullDocument) {\r\n      try {\r\n        await this.updateProfileFromContractChange(\r\n          data.fullDocument as Contract,\r\n        );\r\n        Logger.info(`Data inserted for source: ${data.source}`);\r\n      } catch (error) {\r\n        Logger.error(`Data insertion failed: ${(error as Error).message}`);\r\n        throw error;\r\n      }\r\n    } else {\r\n      Logger.info(`Unhandled data insertion for source: ${data.source}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles updated data events\r\n   * @param data - Data change event\r\n   */\r\n  protected async handleDataUpdated(data: DataChangeEvent): Promise<void> {\r\n    if (data.source === 'contracts' && data.updateDescription?.updatedFields) {\r\n      await this.updateProfileFromContractChange(\r\n        data.updateDescription.updatedFields as Contract,\r\n      );\r\n    } else {\r\n      Logger.info(`Unhandled data update for source: ${data.source}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles deleted data events\r\n   * @param data - Data change event\r\n   */\r\n  protected handleDataDeleted(data: DataChangeEvent): void {\r\n    if (data.source === 'contracts') {\r\n      Logger.info(`Removing contract: ${data.documentKey?._id}`);\r\n    } else {\r\n      Logger.info(`Unhandled data deletion for source: ${data.source}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Updates matching information for a profile\r\n   * @param profile - Profile instance\r\n   * @param data - Matching data\r\n   */\r\n  protected async updateMatchingForProfile(\r\n    profile: Profile,\r\n    data: unknown,\r\n  ): Promise<void> {\r\n    const matchingService = MatchingService.retrieveService();\r\n    await matchingService.updateProfile(profile, data);\r\n  }\r\n\r\n  /**\r\n   * Updates recommendations for a profile\r\n   * @param profile - Profile instance\r\n   * @param data - Recommendation data\r\n   */\r\n  protected async updateRecommendationForProfile(\r\n    profile: Profile,\r\n    data: unknown,\r\n  ): Promise<void> {\r\n    const recommendationService = RecommendationService.retrieveService();\r\n    await recommendationService.updateProfile(profile, data);\r\n    // todo: save\r\n  }\r\n}\r\n","import { Profile } from './Profile';\r\nimport { Agent } from './Agent';\r\nimport { ContractAgent } from './ContractAgent';\r\nimport { SearchCriteria, FilterOperator, ProfileConfigurations } from './types';\r\n\r\nexport class RequestHandler {\r\n  private contractAgent?: ContractAgent;\r\n  private profilesHost: string = '';\r\n\r\n  constructor() {}\r\n\r\n  async prepare() {\r\n    this.contractAgent = await ContractAgent.retrieveService();\r\n    this.profilesHost = Agent.getProfileHost();\r\n    if (!this.profilesHost) {\r\n      throw new Error('Profiles Host not set');\r\n    }\r\n  }\r\n\r\n  // Return only the policies from recommendations\r\n  async getPoliciesRecommendationFromProfile(profileId: string): Promise<any> {\r\n    const criteria: SearchCriteria = {\r\n      conditions: [\r\n        {\r\n          field: 'url',\r\n          operator: FilterOperator.EQUALS,\r\n          value: profileId,\r\n        },\r\n      ],\r\n      threshold: 0,\r\n    };\r\n\r\n    if (!this.contractAgent) {\r\n      throw new Error('Contract Agent undefined');\r\n    }\r\n    const profiles = await this.contractAgent.findProfiles(\r\n      this.profilesHost,\r\n      criteria,\r\n    );\r\n    if (profiles.length === 0) {\r\n      throw new Error('Profile not found');\r\n    }\r\n    return profiles[0].recommendations.map((rec) => rec.policies);\r\n  }\r\n\r\n  // Return only the services from recommendations\r\n  async getServicesRecommendationFromProfile(profileId: string): Promise<any> {\r\n    const criteria: SearchCriteria = {\r\n      conditions: [\r\n        {\r\n          field: 'url',\r\n          operator: FilterOperator.EQUALS,\r\n          value: profileId,\r\n        },\r\n      ],\r\n      threshold: 0,\r\n    };\r\n    if (!this.contractAgent) {\r\n      throw new Error('Contract Agent undefined');\r\n    }\r\n    const profiles = await this.contractAgent.findProfiles(\r\n      this.profilesHost,\r\n      criteria,\r\n    );\r\n    if (profiles.length === 0) {\r\n      throw new Error('Profile not found');\r\n    }\r\n    return profiles[0].recommendations.map((rec) => rec.services);\r\n  }\r\n\r\n  // Return only the policies from matching\r\n  async getPoliciesMatchingFromProfile(profileId: string): Promise<any> {\r\n    const criteria: SearchCriteria = {\r\n      conditions: [\r\n        {\r\n          field: 'url',\r\n          operator: FilterOperator.EQUALS,\r\n          value: profileId,\r\n        },\r\n      ],\r\n      threshold: 0,\r\n    };\r\n\r\n    if (!this.contractAgent) {\r\n      throw new Error('Contract Agent undefined');\r\n    }\r\n    const profiles = await this.contractAgent.findProfiles(\r\n      this.profilesHost,\r\n      criteria,\r\n    );\r\n    if (profiles.length === 0) {\r\n      throw new Error('Profile not found');\r\n    }\r\n    return profiles[0].matching.map((match) => match.policies);\r\n  }\r\n\r\n  // Return only the services from matching\r\n  async getServicesMatchingFromProfile(profileId: string): Promise<any> {\r\n    const criteria: SearchCriteria = {\r\n      conditions: [\r\n        {\r\n          field: 'url',\r\n          operator: FilterOperator.EQUALS,\r\n          value: profileId,\r\n        },\r\n      ],\r\n      threshold: 0,\r\n    };\r\n    if (!this.contractAgent) {\r\n      throw new Error('Contract Agent undefined');\r\n    }\r\n    const profiles = await this.contractAgent.findProfiles(\r\n      this.profilesHost,\r\n      criteria,\r\n    );\r\n    if (profiles.length === 0) {\r\n      throw new Error('Profile not found');\r\n    }\r\n    return profiles[0].matching.map((match) => match.services);\r\n  }\r\n\r\n  // Return only the ecosystemContracts from matching\r\n  async getContractMatchingFromProfile(profileId: string): Promise<any> {\r\n    const criteria: SearchCriteria = {\r\n      conditions: [\r\n        {\r\n          field: 'url',\r\n          operator: FilterOperator.EQUALS,\r\n          value: profileId,\r\n        },\r\n      ],\r\n      threshold: 0,\r\n    };\r\n\r\n    if (!this.contractAgent) {\r\n      throw new Error('Contract Agent undefined');\r\n    }\r\n    const profiles = await this.contractAgent.findProfiles(\r\n      this.profilesHost,\r\n      criteria,\r\n    );\r\n    if (profiles.length === 0) {\r\n      throw new Error('Profile not found');\r\n    }\r\n    return profiles[0].matching.map((match) => match.ecosystemContracts);\r\n  }\r\n\r\n  // configurations\r\n\r\n  async getConfigurationsFromProfile(profileId: string): Promise<any> {\r\n    const criteria: SearchCriteria = {\r\n      conditions: [\r\n        {\r\n          field: 'url',\r\n          operator: FilterOperator.EQUALS,\r\n          value: profileId,\r\n        },\r\n      ],\r\n      threshold: 0,\r\n    };\r\n    if (!this.contractAgent) {\r\n      throw new Error('Contract Agent undefined');\r\n    }\r\n    const profiles = await this.contractAgent.findProfiles(\r\n      this.profilesHost,\r\n      criteria,\r\n    );\r\n    if (profiles.length === 0) {\r\n      throw new Error('Profile not found');\r\n    }\r\n    return profiles[0].configurations;\r\n  }\r\n\r\n  async addConfigurationsToProfile(\r\n    profileId: string,\r\n    configurations: any,\r\n  ): Promise<any> {\r\n    const criteria: SearchCriteria = {\r\n      conditions: [\r\n        {\r\n          field: 'url',\r\n          operator: FilterOperator.EQUALS,\r\n          value: profileId,\r\n        },\r\n      ],\r\n      threshold: 0,\r\n    };\r\n    if (!this.contractAgent) {\r\n      throw new Error('Contract Agent undefined');\r\n    }\r\n    const profiles = await this.contractAgent.findProfiles(\r\n      this.profilesHost,\r\n      criteria,\r\n    );\r\n    if (profiles.length === 0) {\r\n      throw new Error('Profile not found');\r\n    }\r\n    const profile = profiles[0];\r\n    profile.configurations = { ...profile.configurations, ...configurations };\r\n    await this.contractAgent.saveProfile(this.profilesHost, criteria, profile);\r\n    return { message: 'Configurations added successfully', profile };\r\n  }\r\n\r\n  async updateConfigurationsForProfile(\r\n    profileId: string,\r\n    configurations: any,\r\n  ): Promise<any> {\r\n    const criteria: SearchCriteria = {\r\n      conditions: [\r\n        {\r\n          field: 'url',\r\n          operator: FilterOperator.EQUALS,\r\n          value: profileId,\r\n        },\r\n      ],\r\n      threshold: 0,\r\n    };\r\n    if (!this.contractAgent) {\r\n      throw new Error('Contract Agent undefined');\r\n    }\r\n    const profiles = await this.contractAgent.findProfiles(\r\n      this.profilesHost,\r\n      criteria,\r\n    );\r\n    if (profiles.length === 0) {\r\n      throw new Error('Profile not found');\r\n    }\r\n    const profile = profiles[0];\r\n    profile.configurations = configurations;\r\n    await this.contractAgent.saveProfile(this.profilesHost, criteria, profile);\r\n    return { message: 'Configurations updated successfully', profile };\r\n  }\r\n\r\n  async removeConfigurationsFromProfile(profileId: string): Promise<any> {\r\n    const criteria: SearchCriteria = {\r\n      conditions: [\r\n        {\r\n          field: 'url',\r\n          operator: FilterOperator.EQUALS,\r\n          value: profileId,\r\n        },\r\n      ],\r\n      threshold: 0,\r\n    };\r\n    if (!this.contractAgent) {\r\n      throw new Error('Contract Agent undefined');\r\n    }\r\n    const profiles = await this.contractAgent.findProfiles(\r\n      this.profilesHost,\r\n      criteria,\r\n    );\r\n    if (profiles.length === 0) {\r\n      throw new Error('Profile not found');\r\n    }\r\n    const profile: Profile = profiles[0];\r\n    profile.configurations = {\r\n      allowRecommendation: false,\r\n      allowPolicies: false,\r\n    };\r\n    await this.contractAgent.saveProfile(this.profilesHost, criteria, profile);\r\n    return { message: 'Configurations removed successfully', profile };\r\n  }\r\n}\r\n","import { RequestHandler } from 'ContractAgentHandler';\r\nimport express, { Request, Response, Router } from 'express';\r\nconst router: Router = express.Router();\r\n\r\nconst requestHandler = new RequestHandler();\r\n\r\nrouter.get(\r\n  '/profile/:id/policies-recommendations',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const policies =\r\n        await requestHandler.getPoliciesRecommendationFromProfile(\r\n          req.params.id,\r\n        );\r\n      res.json(policies);\r\n    } catch (error) {\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.get(\r\n  '/profile/:id/services-recommendations',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const services =\r\n        await requestHandler.getServicesRecommendationFromProfile(\r\n          req.params.id,\r\n        );\r\n      res.json(services);\r\n    } catch (error) {\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.get(\r\n  '/profile/:id/policies-matching',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const policies = await requestHandler.getPoliciesMatchingFromProfile(\r\n        req.params.id,\r\n      );\r\n      res.json(policies);\r\n    } catch (error) {\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.get(\r\n  '/profile/:id/services-matching',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const services = await requestHandler.getServicesMatchingFromProfile(\r\n        req.params.id,\r\n      );\r\n      res.json(services);\r\n    } catch (error) {\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.get(\r\n  '/profile/:id/service-recommendations',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const services =\r\n        await requestHandler.getServicesRecommendationFromProfile(\r\n          req.params.id,\r\n        );\r\n      res.json(services);\r\n    } catch (error) {\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.get(\r\n  '/profile/:id/policies-matching',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const policies = await requestHandler.getPoliciesMatchingFromProfile(\r\n        req.params.id,\r\n      );\r\n      res.json(policies);\r\n    } catch (error) {\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.get(\r\n  '/profile/:id/contract-matching',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const contracts = await requestHandler.getContractMatchingFromProfile(\r\n        req.params.id,\r\n      );\r\n      res.json(contracts);\r\n    } catch (error) {\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.get(\r\n  '/profile/:id/configurations',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const configurations = await requestHandler.getConfigurationsFromProfile(\r\n        req.params.id,\r\n      );\r\n      res.json(configurations);\r\n    } catch (error) {\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.post('/profile/configurations', async (req: Request, res: Response) => {\r\n  try {\r\n    const { profileId, configurations } = req.body;\r\n    const result = await requestHandler.addConfigurationsToProfile(\r\n      profileId,\r\n      configurations,\r\n    );\r\n    res.status(201).json(result);\r\n  } catch (error) {\r\n    res.status(500).json({ error: (error as Error).message });\r\n  }\r\n});\r\n\r\nrouter.put(\r\n  '/profile/:id/configurations',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const { configurations } = req.body;\r\n      const result = await requestHandler.updateConfigurationsForProfile(\r\n        req.params.id,\r\n        configurations,\r\n      );\r\n      res.json(result);\r\n    } catch (error) {\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nrouter.delete(\r\n  '/profile/:id/configurations',\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const result = await requestHandler.removeConfigurationsFromProfile(\r\n        req.params.id,\r\n      );\r\n      res.json(result);\r\n    } catch (error) {\r\n      res.status(500).json({ error: (error as Error).message });\r\n    }\r\n  },\r\n);\r\n\r\nexport default router;\r\n"],"mappings":"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","names":["CAECode","import_path","path","_a","express","import_express","router","express"]}
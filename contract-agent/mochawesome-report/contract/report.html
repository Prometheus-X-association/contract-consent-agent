<!doctype html>
<html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title>Mochawesome Report</title><link rel="stylesheet" href="assets\app.css"/></head><body data-raw="{&quot;stats&quot;:{&quot;suites&quot;:12,&quot;tests&quot;:78,&quot;passes&quot;:78,&quot;pending&quot;:0,&quot;failures&quot;:0,&quot;testsRegistered&quot;:78,&quot;passPercent&quot;:100,&quot;pendingPercent&quot;:0,&quot;other&quot;:0,&quot;hasOther&quot;:false,&quot;skipped&quot;:0,&quot;hasSkipped&quot;:false,&quot;start&quot;:&quot;2025-01-22T14:26:29.053Z&quot;,&quot;end&quot;:&quot;2025-01-22T14:28:26.110Z&quot;,&quot;duration&quot;:117057},&quot;results&quot;:[{&quot;uuid&quot;:&quot;b5ccb29b-e9a6-48d1-a033-e07b7959606b&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.0.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;377b693f-d6ac-4fc7-8af1-692c8b8e3d2f&quot;,&quot;title&quot;:&quot;Contract Agent Test Cases&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.0.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Contract Agent Test Cases\&quot;&quot;,&quot;fullTitle&quot;:&quot;Contract Agent Test Cases \&quot;before all\&quot; hook in \&quot;Contract Agent Test Cases\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:35,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    Agent_1.Agent.setConfigPath(&#x27;./mocks/contract-agent.config.json&#x27;, __filename);\n    contractAgent = yield ContractAgent_1.ContractAgent.retrieveService();\n    contractProvider = contractAgent.getDataProvider(&#x27;contracts&#x27;);\n    updateProfileFromContractChangeSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfileFromContractChange&#x27;);\n    updateProfilesForMembersSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfilesForMembers&#x27;);\n    updateProfilesForServiceOfferingsSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfilesForServiceOfferings&#x27;);\n    updateProfileForOrchestratorSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfileForOrchestrator&#x27;);\n    updateProfileSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfile&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;587b312d-dc63-4b9a-bfbc-2a01f09be927&quot;,&quot;parentUUID&quot;:&quot;377b693f-d6ac-4fc7-8af1-692c8b8e3d2f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Contract Agent Test Cases\&quot;&quot;,&quot;fullTitle&quot;:&quot;Contract Agent Test Cases \&quot;after all\&quot; hook in \&quot;Contract Agent Test Cases\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    updateProfileFromContractChangeSpy.restore();\n    updateProfilesForMembersSpy.restore();\n    updateProfilesForServiceOfferingsSpy.restore();\n    updateProfileForOrchestratorSpy.restore();\n    updateProfileSpy.restore();\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;786456e3-4e87-4079-99f4-f127ce5efc1e&quot;,&quot;parentUUID&quot;:&quot;377b693f-d6ac-4fc7-8af1-692c8b8e3d2f&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should verify the flow for creating a contract and updating profiles&quot;,&quot;fullTitle&quot;:&quot;Contract Agent Test Cases should verify the flow for creating a contract and updating profiles&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:118,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    createdDocument = yield contractProvider.create(contract_mock_1.ContractBase);\n    (0, chai_1.expect)(createdDocument).to.have.property(&#x27;_id&#x27;);\n    yield delay(100);\n    yield new Promise(setImmediate);\n    sinon_1.default.assert.calledOnce(updateProfileFromContractChangeSpy);\n    (0, chai_1.expect)(updateProfileFromContractChangeSpy.calledOnce).to.be.true;\n    sinon_1.default.assert.calledOnce(updateProfilesForMembersSpy);\n    sinon_1.default.assert.calledOnce(updateProfilesForServiceOfferingsSpy);\n    sinon_1.default.assert.calledOnce(updateProfileForOrchestratorSpy);\n    sinon_1.default.assert.callCount(updateProfileSpy, contract_mock_1.ContractBase.members.length + contract_mock_1.ContractBase.serviceOfferings.length + 1);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ba7561e8-5a54-43b9-9492-8f0572699aa0&quot;,&quot;parentUUID&quot;:&quot;377b693f-d6ac-4fc7-8af1-692c8b8e3d2f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should delete the previously created contract successfully&quot;,&quot;fullTitle&quot;:&quot;Contract Agent Test Cases should delete the previously created contract successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:4,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    (0, chai_1.expect)(createdDocument).to.not.be.undefined;\n    const deleteResult = yield contractProvider.delete(createdDocument._id.toString());\n    (0, chai_1.expect)(deleteResult).to.be.true;\n    const secondDeleteResult = yield contractProvider.delete(createdDocument._id.toString());\n    (0, chai_1.expect)(secondDeleteResult).to.be.false;\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c306b132-5ffb-41cb-aaac-a567a775f8c1&quot;,&quot;parentUUID&quot;:&quot;377b693f-d6ac-4fc7-8af1-692c8b8e3d2f&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;ba7561e8-5a54-43b9-9492-8f0572699aa0&quot;,&quot;c306b132-5ffb-41cb-aaac-a567a775f8c1&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:122,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;0f559196-71d0-41bb-a135-a79a92ce33cf&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8e9ee21a-b520-407f-871a-d589ad4e5b8b&quot;,&quot;title&quot;:&quot;Negotiation Service Test Cases&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Negotiation Service Test Cases\&quot;&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases \&quot;before each\&quot; hook in \&quot;Negotiation Service Test Cases\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;negotiationService = NegotiationService_1.NegotiationService.retrieveService(true);\nprofile = new Profile_1.Profile({\n    uri: &#x27;test-uri&#x27;,\n    configurations: {\n        allowPolicies: true,\n        allowRecommendations: true,\n    },\n    preference: [\n        {\n            policies: [\n                { policy: &#x27;allowed-policy&#x27;, frequency: 1 },\n                { policy: &#x27;another-policy&#x27;, frequency: 1 },\n            ],\n            services: [&#x27;allowed-service&#x27;],\n            ecosystems: [&#x27;test-ecosystem&#x27;],\n        },\n    ],\n    recommendations: [],\n    matching: [],\n});\ncontract = new Contract_1.Contract({\n    ecosystem: &#x27;test-ecosystem&#x27;,\n    status: &#x27;active&#x27;,\n    serviceOfferings: [\n        {\n            participant: &#x27;test-participant&#x27;,\n            serviceOffering: &#x27;allowed-service&#x27;,\n            policies: [\n                {\n                    description: &#x27;allowed-policy&#x27;,\n                    permission: [],\n                    prohibition: [],\n                },\n            ],\n        },\n    ],\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    members: [],\n    orchestrator: &#x27;&#x27;,\n    purpose: [],\n    revokedMembers: [],\n    rolesAndObligations: [],\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e6d2f467-2dab-4a91-ab63-33aa810b7aec&quot;,&quot;parentUUID&quot;:&quot;8e9ee21a-b520-407f-871a-d589ad4e5b8b&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;ff4b63b3-a77f-46c1-aa43-65b2d7af59bf&quot;,&quot;title&quot;:&quot;isPolicyAcceptable&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept allowed policy&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isPolicyAcceptable should accept allowed policy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const policy = {\n    description: &#x27;allowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n};\n(0, chai_1.expect)(negotiationService.isPolicyAcceptable(profile, policy)).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;654ee8f4-4f0e-4df4-98d9-0dccdb40a384&quot;,&quot;parentUUID&quot;:&quot;ff4b63b3-a77f-46c1-aa43-65b2d7af59bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject disallowed policy&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isPolicyAcceptable should reject disallowed policy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const policy = {\n    description: &#x27;disallowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n};\n(0, chai_1.expect)(negotiationService.isPolicyAcceptable(profile, policy)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b5df10a5-4436-4cb7-8ecb-bd83b8542d04&quot;,&quot;parentUUID&quot;:&quot;ff4b63b3-a77f-46c1-aa43-65b2d7af59bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject all policies when allowPolicies is false&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isPolicyAcceptable should reject all policies when allowPolicies is false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;profile.configurations.allowPolicies = false;\nconst policy = {\n    description: &#x27;allowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n};\n(0, chai_1.expect)(negotiationService.isPolicyAcceptable(profile, policy)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e4391234-73ba-4c52-a0b4-f7d68818221b&quot;,&quot;parentUUID&quot;:&quot;ff4b63b3-a77f-46c1-aa43-65b2d7af59bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should check policy frequency&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isPolicyAcceptable should check policy frequency&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;profile.preference[0].policies[0].frequency = 0;\nconst policy = {\n    description: &#x27;allowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n};\n(0, chai_1.expect)(negotiationService.isPolicyAcceptable(profile, policy)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7fbc61a2-19fd-44d9-be55-e336ea18da8e&quot;,&quot;parentUUID&quot;:&quot;ff4b63b3-a77f-46c1-aa43-65b2d7af59bf&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;654ee8f4-4f0e-4df4-98d9-0dccdb40a384&quot;,&quot;b5df10a5-4436-4cb7-8ecb-bd83b8542d04&quot;,&quot;e4391234-73ba-4c52-a0b4-f7d68818221b&quot;,&quot;7fbc61a2-19fd-44d9-be55-e336ea18da8e&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;3a3e671a-2c65-4bb4-8a4a-ec894209358d&quot;,&quot;title&quot;:&quot;isServiceAcceptable&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept allowed service&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isServiceAcceptable should accept allowed service&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const service = {\n    participant: &#x27;test&#x27;,\n    serviceOffering: &#x27;allowed-service&#x27;,\n    policies: [],\n};\n(0, chai_1.expect)(negotiationService.isServiceAcceptable(profile, service)).to.be\n    .true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b487eb73-d934-472e-819f-d914920edf05&quot;,&quot;parentUUID&quot;:&quot;3a3e671a-2c65-4bb4-8a4a-ec894209358d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject disallowed service&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isServiceAcceptable should reject disallowed service&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const service = {\n    participant: &#x27;test&#x27;,\n    serviceOffering: &#x27;disallowed-service&#x27;,\n    policies: [],\n};\n(0, chai_1.expect)(negotiationService.isServiceAcceptable(profile, service)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;242ead31-935b-4976-8b2a-1776337c5795&quot;,&quot;parentUUID&quot;:&quot;3a3e671a-2c65-4bb4-8a4a-ec894209358d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b487eb73-d934-472e-819f-d914920edf05&quot;,&quot;242ead31-935b-4976-8b2a-1776337c5795&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;a71875bc-bd97-41a3-a1b2-d034e9c9fc6a&quot;,&quot;title&quot;:&quot;canAcceptContract&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept valid contract&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases canAcceptContract should accept valid contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;(0, chai_1.expect)(negotiationService.canAcceptContract(profile, contract)).to.be\n    .true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;de20672a-e03e-406b-8675-a6d944ff2ccc&quot;,&quot;parentUUID&quot;:&quot;a71875bc-bd97-41a3-a1b2-d034e9c9fc6a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject inactive contract&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases canAcceptContract should reject inactive contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.status = &#x27;inactive&#x27;;\n(0, chai_1.expect)(negotiationService.canAcceptContract(profile, contract)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;96fcdb65-ad18-4ff1-974b-501af380557c&quot;,&quot;parentUUID&quot;:&quot;a71875bc-bd97-41a3-a1b2-d034e9c9fc6a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject contract with unacceptable service offering&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases canAcceptContract should reject contract with unacceptable service offering&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.serviceOfferings[0].serviceOffering = &#x27;disallowed-service&#x27;;\n(0, chai_1.expect)(negotiationService.canAcceptContract(profile, contract)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7c3d7d01-d68e-4828-ad67-7dc4fd7df432&quot;,&quot;parentUUID&quot;:&quot;a71875bc-bd97-41a3-a1b2-d034e9c9fc6a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject contract with unacceptable policies&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases canAcceptContract should reject contract with unacceptable policies&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.serviceOfferings[0].policies.push({\n    description: &#x27;disallowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n});\n(0, chai_1.expect)(negotiationService.canAcceptContract(profile, contract)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;7d4b48f4-bc0b-4f8e-8260-e0dfaf6c3117&quot;,&quot;parentUUID&quot;:&quot;a71875bc-bd97-41a3-a1b2-d034e9c9fc6a&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;de20672a-e03e-406b-8675-a6d944ff2ccc&quot;,&quot;96fcdb65-ad18-4ff1-974b-501af380557c&quot;,&quot;7c3d7d01-d68e-4828-ad67-7dc4fd7df432&quot;,&quot;7d4b48f4-bc0b-4f8e-8260-e0dfaf6c3117&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;6808dd09-f698-4bf2-a6c6-ee6527432a05&quot;,&quot;title&quot;:&quot;negotiateContract&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return successful negotiation for valid contract&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases negotiateContract should return successful negotiation for valid contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const result = negotiationService.negotiateContract(profile, contract);\n(0, chai_1.expect)(result.canAccept).to.be.true;\n(0, chai_1.expect)(result.reason).to.be.undefined;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5ba19e67-84c1-433e-8edd-41905450abc9&quot;,&quot;parentUUID&quot;:&quot;6808dd09-f698-4bf2-a6c6-ee6527432a05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return failed negotiation with unacceptable policies&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases negotiateContract should return failed negotiation with unacceptable policies&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.serviceOfferings[0].policies.push({\n    description: &#x27;disallowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n});\nconst result = negotiationService.negotiateContract(profile, contract);\n(0, chai_1.expect)(result.canAccept).to.be.false;\n(0, chai_1.expect)(result.unacceptablePolicies).to.include(&#x27;disallowed-policy&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9abcdb0f-7cba-4f2f-807f-5e75a278fbd4&quot;,&quot;parentUUID&quot;:&quot;6808dd09-f698-4bf2-a6c6-ee6527432a05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return failed negotiation with unacceptable services&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases negotiateContract should return failed negotiation with unacceptable services&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.serviceOfferings[0].serviceOffering = &#x27;disallowed-service&#x27;;\nconst result = negotiationService.negotiateContract(profile, contract);\n(0, chai_1.expect)(result.canAccept).to.be.false;\n(0, chai_1.expect)(result.unacceptableServices).to.include(&#x27;disallowed-service&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;00954b7b-b164-4c4f-b244-95e4c2f373d0&quot;,&quot;parentUUID&quot;:&quot;6808dd09-f698-4bf2-a6c6-ee6527432a05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors during negotiation&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases negotiateContract should handle errors during negotiation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const corruptedContract = null;\nconst result = negotiationService.negotiateContract(profile, corruptedContract);\n(0, chai_1.expect)(result.canAccept).to.be.false;\n(0, chai_1.expect)(result.reason).to.equal(&#x27;An error occurred during negotiation.&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;822f5e0a-c82a-4c09-bd1a-6be3bf28cee9&quot;,&quot;parentUUID&quot;:&quot;6808dd09-f698-4bf2-a6c6-ee6527432a05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should identify multiple unacceptable policies and services&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases negotiateContract should identify multiple unacceptable policies and services&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.serviceOfferings = [\n    {\n        participant: &#x27;test&#x27;,\n        serviceOffering: &#x27;disallowed-service-1&#x27;,\n        policies: [\n            {\n                description: &#x27;disallowed-policy-1&#x27;,\n                permission: [],\n                prohibition: [],\n            },\n        ],\n    },\n    {\n        participant: &#x27;test&#x27;,\n        serviceOffering: &#x27;disallowed-service-2&#x27;,\n        policies: [\n            {\n                description: &#x27;disallowed-policy-2&#x27;,\n                permission: [],\n                prohibition: [],\n            },\n        ],\n    },\n];\nconst result = negotiationService.negotiateContract(profile, contract);\n(0, chai_1.expect)(result.canAccept).to.be.false;\n(0, chai_1.expect)(result.unacceptablePolicies).to.have.members([\n    &#x27;disallowed-policy-1&#x27;,\n    &#x27;disallowed-policy-2&#x27;,\n]);\n(0, chai_1.expect)(result.unacceptableServices).to.have.members([\n    &#x27;disallowed-service-1&#x27;,\n    &#x27;disallowed-service-2&#x27;,\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;73012375-0d7b-451e-a499-ba21db7216d0&quot;,&quot;parentUUID&quot;:&quot;6808dd09-f698-4bf2-a6c6-ee6527432a05&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;5ba19e67-84c1-433e-8edd-41905450abc9&quot;,&quot;9abcdb0f-7cba-4f2f-807f-5e75a278fbd4&quot;,&quot;00954b7b-b164-4c4f-b244-95e4c2f373d0&quot;,&quot;822f5e0a-c82a-4c09-bd1a-6be3bf28cee9&quot;,&quot;73012375-0d7b-451e-a499-ba21db7216d0&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;480ac7b2-a91d-426d-a642-4f1f3b004c89&quot;,&quot;title&quot;:&quot;areServicePoliciesAcceptable&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept service with acceptable policies&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases areServicePoliciesAcceptable should accept service with acceptable policies&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const service = {\n    participant: &#x27;test&#x27;,\n    serviceOffering: &#x27;allowed-service&#x27;,\n    policies: [\n        {\n            description: &#x27;allowed-policy&#x27;,\n            permission: [],\n            prohibition: [],\n        },\n    ],\n};\n(0, chai_1.expect)(negotiationService.areServicePoliciesAcceptable(profile, service))\n    .to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;609d749b-0040-4322-a937-ba6088142e20&quot;,&quot;parentUUID&quot;:&quot;480ac7b2-a91d-426d-a642-4f1f3b004c89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject service with unacceptable policies&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases areServicePoliciesAcceptable should reject service with unacceptable policies&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const service = {\n    participant: &#x27;test&#x27;,\n    serviceOffering: &#x27;allowed-service&#x27;,\n    policies: [\n        {\n            description: &#x27;disallowed-policy&#x27;,\n            permission: [],\n            prohibition: [],\n        },\n    ],\n};\n(0, chai_1.expect)(negotiationService.areServicePoliciesAcceptable(profile, service))\n    .to.be.false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0d360f54-c2e5-415e-81df-87b8619f27c5&quot;,&quot;parentUUID&quot;:&quot;480ac7b2-a91d-426d-a642-4f1f3b004c89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;609d749b-0040-4322-a937-ba6088142e20&quot;,&quot;0d360f54-c2e5-415e-81df-87b8619f27c5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;9dcda039-ef40-4638-8abf-7316269ea2ca&quot;,&quot;title&quot;:&quot;updateProfilePreferences&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should add valid preferences&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases updateProfilePreferences should add valid preferences&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const newPreferences = [\n    {\n        policies: [{ policy: &#x27;new-policy&#x27;, frequency: 1 }],\n        services: [&#x27;new-service&#x27;],\n        ecosystems: [&#x27;new-ecosystem&#x27;],\n    },\n];\nconst initialLength = profile.preference.length;\nnegotiationService.updateProfilePreferences(profile, newPreferences);\n(0, chai_1.expect)(profile.preference.length).to.equal(initialLength + 1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fe449f72-880b-46fe-8230-0274bee69c4e&quot;,&quot;parentUUID&quot;:&quot;9dcda039-ef40-4638-8abf-7316269ea2ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should filter out invalid preferences&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases updateProfilePreferences should filter out invalid preferences&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const invalidPreferences = [\n    undefined,\n    null,\n    { policies: null, services: [], ecosystems: [] },\n];\nconst initialLength = profile.preference.length;\nnegotiationService.updateProfilePreferences(profile, invalidPreferences);\n(0, chai_1.expect)(profile.preference.length).to.equal(initialLength);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;39d361dd-c275-4d8b-93b3-8e21a0446f5a&quot;,&quot;parentUUID&quot;:&quot;9dcda039-ef40-4638-8abf-7316269ea2ca&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fe449f72-880b-46fe-8230-0274bee69c4e&quot;,&quot;39d361dd-c275-4d8b-93b3-8e21a0446f5a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;cb285819-d518-47ac-9c57-8346178a0e89&quot;,&quot;title&quot;:&quot;NegotiationService Singleton&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return the same instance without refresh&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases NegotiationService Singleton should return the same instance without refresh&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const instance1 = NegotiationService_1.NegotiationService.retrieveService();\nconst instance2 = NegotiationService_1.NegotiationService.retrieveService();\n(0, chai_1.expect)(instance1).to.equal(instance2);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;be69f281-9ba8-49da-a86e-d273656cafd5&quot;,&quot;parentUUID&quot;:&quot;cb285819-d518-47ac-9c57-8346178a0e89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return a new instance with refresh&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases NegotiationService Singleton should return a new instance with refresh&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const instance1 = NegotiationService_1.NegotiationService.retrieveService();\nconst instance2 = NegotiationService_1.NegotiationService.retrieveService(true);\n(0, chai_1.expect)(instance1).to.not.equal(instance2);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bbc0ea31-584a-4f2e-9482-4a92c447b4d4&quot;,&quot;parentUUID&quot;:&quot;cb285819-d518-47ac-9c57-8346178a0e89&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;be69f281-9ba8-49da-a86e-d273656cafd5&quot;,&quot;bbc0ea31-584a-4f2e-9482-4a92c447b4d4&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;f86012d9-5746-458b-8e92-ad0fcd4b9025&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.3.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.3.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;c191771c-3bc6-4477-8104-d7a25dfd8a64&quot;,&quot;title&quot;:&quot;MongooseProvider Events Tests&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.3.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.3.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests \&quot;before all\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:40,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        provider = new MongooseProvider_1.MongooseProvider({\n            source: &#x27;contracts&#x27;,\n            url: &#x27;mongodb://localhost:27017&#x27;,\n            dbName: &#x27;test&#x27;,\n        });\n        provider.on(&#x27;dataInserted&#x27;, (event) =&gt; {\n            dataInsertedEventReceived = true;\n            dataInsertedPayload = event;\n        });\n        provider.on(&#x27;dataUpdated&#x27;, (event) =&gt; {\n            dataUpdatedEventReceived = true;\n            dataUpdatedPayload = event;\n        });\n        provider.on(&#x27;dataDeleted&#x27;, (event) =&gt; {\n            dataDeletedEventReceived = true;\n            dataDeletedPayload = event;\n        });\n        model = yield contract_model_mock_1.default.getModel();\n        yield provider.ensureReady();\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;21d0e84b-581e-44d3-8552-5e2db42914ce&quot;,&quot;parentUUID&quot;:&quot;c191771c-3bc6-4477-8104-d7a25dfd8a64&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests \&quot;before each\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        dataInsertedEventReceived = false;\n        dataInsertedPayload = null;\n        dataUpdatedEventReceived = false;\n        dataUpdatedPayload = null;\n        dataDeletedEventReceived = false;\n        dataDeletedPayload = null;\n        yield model.deleteMany({});\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;696f35f3-60a5-4eef-97df-f205bcd96140&quot;,&quot;parentUUID&quot;:&quot;c191771c-3bc6-4477-8104-d7a25dfd8a64&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests \&quot;after all\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:70,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        yield model.deleteMany({});\n        yield mongoose_1.default.disconnect();\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;63fd89b6-e5a9-4b78-8c70-21f8ed1362ed&quot;,&quot;parentUUID&quot;:&quot;c191771c-3bc6-4477-8104-d7a25dfd8a64&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should emit dataInserted event when saving a new document&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests should emit dataInserted event when saving a new document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:138,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        const contractData = {\n            uid: &#x27;test-contract-1&#x27;,\n            profile: &#x27;test-profile&#x27;,\n            ecosystem: &#x27;test-ecosystem&#x27;,\n            orchestrator: &#x27;test-orchestrator&#x27;,\n            members: [\n                {\n                    participant: &#x27;test-participant&#x27;,\n                    role: &#x27;test-role&#x27;,\n                    signature: &#x27;test-signature&#x27;,\n                },\n            ],\n            status: &#x27;pending&#x27;,\n            serviceOfferings: [],\n            rolesAndObligations: [],\n            purpose: [],\n            revokedMembers: [],\n        };\n        const contract = new model(contractData);\n        yield contract.save();\n        yield new Promise((resolve) =&gt; setTimeout(resolve, 100));\n        (0, chai_1.expect)(dataInsertedEventReceived).to.be.true;\n        (0, chai_1.expect)(dataInsertedPayload).to.exist;\n        (0, chai_1.expect)(dataInsertedPayload.source).to.equal(&#x27;contracts&#x27;);\n        (0, chai_1.expect)(dataInsertedPayload.fullDocument).to.exist;\n        (0, chai_1.expect)(dataInsertedPayload.fullDocument.uid).to.equal(contractData.uid);\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fb7c5bfd-4159-4972-aaff-f56a0b1b32d6&quot;,&quot;parentUUID&quot;:&quot;c191771c-3bc6-4477-8104-d7a25dfd8a64&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit dataInserted event when creating via model.create()&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests should emit dataInserted event when creating via model.create()&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:127,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        const contractData = {\n            uid: &#x27;test-contract-1&#x27;,\n            profile: &#x27;test-profile&#x27;,\n            ecosystem: &#x27;test-ecosystem&#x27;,\n            orchestrator: &#x27;test-orchestrator&#x27;,\n            members: [\n                {\n                    participant: &#x27;test-participant&#x27;,\n                    role: &#x27;test-role&#x27;,\n                    signature: &#x27;test-signature&#x27;,\n                },\n            ],\n            status: &#x27;pending&#x27;,\n            serviceOfferings: [],\n            rolesAndObligations: [],\n            purpose: [],\n            revokedMembers: [],\n        };\n        yield model.create(contractData);\n        yield new Promise((resolve) =&gt; setTimeout(resolve, 100));\n        (0, chai_1.expect)(dataInsertedEventReceived).to.be.true;\n        (0, chai_1.expect)(dataInsertedPayload).to.exist;\n        (0, chai_1.expect)(dataInsertedPayload.source).to.equal(&#x27;contracts&#x27;);\n        (0, chai_1.expect)(dataInsertedPayload.fullDocument.uid).to.equal(contractData.uid);\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;04879960-b8b8-4b6d-a389-bb221622c811&quot;,&quot;parentUUID&quot;:&quot;c191771c-3bc6-4477-8104-d7a25dfd8a64&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit dataUpdated event when updating via model.updateOne()&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests should emit dataUpdated event when updating via model.updateOne()&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:145,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        const contract = yield model.create({\n            uid: &#x27;test-contract-2&#x27;,\n            profile: &#x27;old-profile&#x27;,\n            ecosystem: &#x27;test-ecosystem&#x27;,\n            orchestrator: &#x27;test-orchestrator&#x27;,\n            status: &#x27;pending&#x27;,\n        });\n        yield model.updateOne({ _id: contract._id }, { $set: { profile: &#x27;new-profile&#x27; } });\n        yield new Promise((resolve) =&gt; setTimeout(resolve, 100));\n        (0, chai_1.expect)(dataUpdatedEventReceived).to.be.true;\n        (0, chai_1.expect)(dataUpdatedPayload).to.exist;\n        (0, chai_1.expect)(dataUpdatedPayload.source).to.equal(&#x27;contracts&#x27;);\n        (0, chai_1.expect)(dataUpdatedPayload.updateDescription).to.exist;\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;da936162-f31d-4883-8888-677805732250&quot;,&quot;parentUUID&quot;:&quot;c191771c-3bc6-4477-8104-d7a25dfd8a64&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit dataDeleted event when deleting via model.deleteOne()&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests should emit dataDeleted event when deleting via model.deleteOne()&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:133,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        const contract = yield model.create({\n            uid: &#x27;test-contract-3&#x27;,\n            profile: &#x27;test-profile&#x27;,\n            ecosystem: &#x27;test-ecosystem&#x27;,\n            orchestrator: &#x27;test-orchestrator&#x27;,\n            status: &#x27;pending&#x27;,\n        });\n        yield model.deleteOne({ _id: contract._id });\n        yield new Promise((resolve) =&gt; setTimeout(resolve, 100));\n        (0, chai_1.expect)(dataDeletedEventReceived).to.be.true;\n        (0, chai_1.expect)(dataDeletedPayload).to.exist;\n        (0, chai_1.expect)(dataDeletedPayload.source).to.equal(&#x27;contracts&#x27;);\n        (0, chai_1.expect)(dataDeletedPayload.documentKey).to.exist;\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e180396f-c8f3-44aa-a97b-6081ae675b88&quot;,&quot;parentUUID&quot;:&quot;c191771c-3bc6-4477-8104-d7a25dfd8a64&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;fb7c5bfd-4159-4972-aaff-f56a0b1b32d6&quot;,&quot;04879960-b8b8-4b6d-a389-bb221622c811&quot;,&quot;da936162-f31d-4883-8888-677805732250&quot;,&quot;e180396f-c8f3-44aa-a97b-6081ae675b88&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:543,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;a2d5973a-cc9d-4cc3-a037-df718fbfc62a&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.4.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.4.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;df100d28-e84e-47c5-8376-767fa469898d&quot;,&quot;title&quot;:&quot;ContractAgent with MongooseProvider&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.4.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.4.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;ContractAgent with MongooseProvider\&quot;&quot;,&quot;fullTitle&quot;:&quot;ContractAgent with MongooseProvider \&quot;before all\&quot; hook in \&quot;ContractAgent with MongooseProvider\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:41,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    Agent_1.Agent.setConfigPath(&#x27;./mocks/contract-agent.config.json&#x27;, __filename);\n    model = yield contract_model_mock_1.default.getModel();\n    agent = yield ContractAgent_1.ContractAgent.retrieveService(MongooseProvider_1.MongooseProvider);\n    updateProfileFromContractChangeSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfileFromContractChange&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;ea75a52c-be6f-4efc-a33c-a2889a0d1740&quot;,&quot;parentUUID&quot;:&quot;df100d28-e84e-47c5-8376-767fa469898d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;ContractAgent with MongooseProvider\&quot;&quot;,&quot;fullTitle&quot;:&quot;ContractAgent with MongooseProvider \&quot;after all\&quot; hook in \&quot;ContractAgent with MongooseProvider\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1011,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    updateProfileFromContractChangeSpy.restore();\n    if (model) {\n        yield model.deleteMany({});\n    }\n    yield Promise.all([\n        mongoose_1.default.disconnect(),\n        new Promise((resolve) =&gt; setTimeout(resolve, 1000)),\n    ]);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8c52494e-d4a7-4a8b-a830-c118ccbb151b&quot;,&quot;parentUUID&quot;:&quot;df100d28-e84e-47c5-8376-767fa469898d&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should initialize correctly and trigger handleDataInserted via create&quot;,&quot;fullTitle&quot;:&quot;ContractAgent with MongooseProvider should initialize correctly and trigger handleDataInserted via create&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:162,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    yield model.create({\n        ecosystem: &#x27;test-ecosystem&#x27;,\n        serviceOfferings: [\n            {\n                participant: &#x27;test-participant&#x27;,\n                serviceOffering: &#x27;allowed-service&#x27;,\n                policies: [\n                    {\n                        description: &#x27;allowed-policy&#x27;,\n                        permission: [],\n                        prohibition: [],\n                    },\n                ],\n            },\n        ],\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        members: [],\n        orchestrator: &#x27;&#x27;,\n        purpose: [],\n        revokedMembers: [],\n        rolesAndObligations: [],\n    });\n    yield delay(100);\n    yield new Promise(setImmediate);\n    sinon_1.default.assert.calledOnce(updateProfileFromContractChangeSpy);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f4116c9e-0336-493c-a298-276820d6804d&quot;,&quot;parentUUID&quot;:&quot;df100d28-e84e-47c5-8376-767fa469898d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should initialize correctly and trigger handleDataInserted via save&quot;,&quot;fullTitle&quot;:&quot;ContractAgent with MongooseProvider should initialize correctly and trigger handleDataInserted via save&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:124,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const contract = new model();\n    updateProfileFromContractChangeSpy.resetHistory();\n    yield contract.save({\n        ecosystem: &#x27;test-ecosystem&#x27;,\n        serviceOfferings: [\n            {\n                participant: &#x27;test-participant&#x27;,\n                serviceOffering: &#x27;allowed-service&#x27;,\n                policies: [\n                    {\n                        description: &#x27;allowed-policy&#x27;,\n                        permission: [],\n                        prohibition: [],\n                    },\n                ],\n            },\n        ],\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        members: [],\n        orchestrator: &#x27;&#x27;,\n        purpose: [],\n        revokedMembers: [],\n        rolesAndObligations: [],\n    });\n    yield delay(100);\n    yield new Promise(setImmediate);\n    sinon_1.default.assert.calledOnce(updateProfileFromContractChangeSpy);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3de672a6-4e81-4cf5-8f55-b0577e486a5c&quot;,&quot;parentUUID&quot;:&quot;df100d28-e84e-47c5-8376-767fa469898d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should trigger updateProfileFromContractChange on update&quot;,&quot;fullTitle&quot;:&quot;ContractAgent with MongooseProvider should trigger updateProfileFromContractChange on update&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:140,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const doc = yield model.create({\n        ecosystem: &#x27;test-ecosystem-update&#x27;,\n        serviceOfferings: [\n            {\n                participant: &#x27;test-participant-update&#x27;,\n                serviceOffering: &#x27;allowed-service&#x27;,\n                policies: [\n                    { description: &#x27;allowed-policy&#x27;, permission: [], prohibition: [] },\n                ],\n            },\n        ],\n        members: [],\n        orchestrator: &#x27;&#x27;,\n        purpose: [],\n        revokedMembers: [],\n        rolesAndObligations: [],\n    });\n    updateProfileFromContractChangeSpy.resetHistory();\n    yield model.findByIdAndUpdate(doc._id, {\n        $set: { ecosystem: &#x27;updated-ecosystem&#x27; },\n    });\n    yield delay(100);\n    yield new Promise(setImmediate);\n    sinon_1.default.assert.calledOnce(updateProfileFromContractChangeSpy);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c69d6b50-1cc2-4bcc-a1bb-13a64811a2c5&quot;,&quot;parentUUID&quot;:&quot;df100d28-e84e-47c5-8376-767fa469898d&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;f4116c9e-0336-493c-a298-276820d6804d&quot;,&quot;3de672a6-4e81-4cf5-8f55-b0577e486a5c&quot;,&quot;c69d6b50-1cc2-4bcc-a1bb-13a64811a2c5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:426,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:10000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;15577657-1b2e-42d8-8b97-aad76e65e416&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.dataprovider.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.dataprovider.0.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;413a5596-35b5-4f9c-b74d-220ab23c3848&quot;,&quot;title&quot;:&quot;DataProvider Events Test Cases&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.dataprovider.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.dataprovider.0.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;DataProvider Events Test Cases\&quot;&quot;,&quot;fullTitle&quot;:&quot;DataProvider Events Test Cases \&quot;before all\&quot; hook in \&quot;DataProvider Events Test Cases\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const config = {\n        url: &#x27;mongodb://localhost:27017&#x27;,\n        dbName: &#x27;contract_consent_agent_db&#x27;,\n        source: collection,\n    };\n    mongoProvider = new MongoDBProvider_1.MongoDBProvider(config);\n    yield mongoProvider.ensureReady();\n    agentTest = new AgentTest(mongoProvider);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f129ce4b-bc2e-4965-9f09-7b491289299b&quot;,&quot;parentUUID&quot;:&quot;413a5596-35b5-4f9c-b74d-220ab23c3848&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;DataProvider Events Test Cases\&quot;&quot;,&quot;fullTitle&quot;:&quot;DataProvider Events Test Cases \&quot;after each\&quot; hook in \&quot;DataProvider Events Test Cases\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;agentTest.handleDataInsertedSpy.resetHistory();\nagentTest.handleDataUpdatedSpy.resetHistory();\nagentTest.handleDataDeletedSpy.resetHistory();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6fe332ae-a0fe-41b2-93ed-dfe7fb21eb15&quot;,&quot;parentUUID&quot;:&quot;413a5596-35b5-4f9c-b74d-220ab23c3848&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should emit dataInserted event when creating a document&quot;,&quot;fullTitle&quot;:&quot;DataProvider Events Test Cases should emit dataInserted event when creating a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const testData = { name: &#x27;test&#x27;, value: 123 };\n    const result = yield mongoProvider.create(testData);\n    (0, chai_1.expect)(agentTest.handleDataInsertedSpy.calledOnce).to.be.true;\n    const eventData = agentTest.handleDataInsertedSpy.firstCall.args[0];\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;source&#x27;, collection);\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;fullDocument&#x27;);\n    (0, chai_1.expect)(eventData.fullDocument).to.include(testData);\n    if (result._id) {\n        yield mongoProvider.delete(result._id.toString());\n    }\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aa327e65-b0f3-4f09-a4af-060b3d6f2cee&quot;,&quot;parentUUID&quot;:&quot;413a5596-35b5-4f9c-b74d-220ab23c3848&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit dataUpdated event when updating a document&quot;,&quot;fullTitle&quot;:&quot;DataProvider Events Test Cases should emit dataUpdated event when updating a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const testData = { name: &#x27;test-update&#x27;, value: 456 };\n    const created = yield mongoProvider.create(testData);\n    agentTest.handleDataInsertedSpy.resetHistory();\n    const updateData = { value: 789 };\n    const criteria = {\n        conditions: [\n            {\n                field: &#x27;_id&#x27;,\n                operator: types_1.FilterOperator.EQUALS,\n                value: created._id,\n            },\n        ],\n        threshold: 0,\n    };\n    yield mongoProvider.update(criteria, updateData);\n    (0, chai_1.expect)(agentTest.handleDataUpdatedSpy.calledOnce).to.be.true;\n    const eventData = agentTest.handleDataUpdatedSpy.firstCall.args[0];\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;source&#x27;, collection);\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;documentKey&#x27;);\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;updateDescription&#x27;);\n    if (created._id) {\n        yield mongoProvider.delete(created._id.toString());\n    }\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3f3aac91-cb6c-4a3b-a82c-589556e04657&quot;,&quot;parentUUID&quot;:&quot;413a5596-35b5-4f9c-b74d-220ab23c3848&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit dataDeleted event when deleting a document&quot;,&quot;fullTitle&quot;:&quot;DataProvider Events Test Cases should emit dataDeleted event when deleting a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const testData = { name: &#x27;test-delete&#x27;, value: 999 };\n    const created = yield mongoProvider.create(testData);\n    agentTest.handleDataInsertedSpy.resetHistory();\n    if (created._id) {\n        yield mongoProvider.delete(created._id.toString());\n    }\n    (0, chai_1.expect)(agentTest.handleDataDeletedSpy.calledOnce).to.be.true;\n    const eventData = agentTest.handleDataDeletedSpy.firstCall.args[0];\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;source&#x27;, collection);\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;documentKey&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1313fa5c-d011-4d11-a850-68720004226a&quot;,&quot;parentUUID&quot;:&quot;413a5596-35b5-4f9c-b74d-220ab23c3848&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;aa327e65-b0f3-4f09-a4af-060b3d6f2cee&quot;,&quot;3f3aac91-cb6c-4a3b-a82c-589556e04657&quot;,&quot;1313fa5c-d011-4d11-a850-68720004226a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:24,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;458d0648-cb96-476b-90cf-c60521e0b424&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.router.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.router.0.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;d02517dc-9213-48b1-8a69-1e4d742067c8&quot;,&quot;title&quot;:&quot;ContractAgent Router Tests&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.router.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.router.0.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;ContractAgent Router Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests \&quot;before all\&quot; hook in \&quot;ContractAgent Router Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:53,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    var _a;\n    Agent_1.Agent.setConfigPath(&#x27;./mocks/contract-agent.config.json&#x27;, __filename);\n    requestHandler = yield ContractAgentHandler_1.RequestHandler.retrieveService();\n    const contractAgent = yield requestHandler.getContractAgent();\n    const profile = yield contractAgent.createProfileForParticipant(&#x27;some-participant-uri&#x27;);\n    profileURI = (_a = profile.uri) !== null &amp;&amp; _a !== void 0 ? _a : profileURI;\n    getPoliciesRecommendationFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getPoliciesRecommendationFromProfile&#x27;);\n    getServicesRecommendationFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getServicesRecommendationFromProfile&#x27;);\n    getPoliciesMatchingFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getPoliciesMatchingFromProfile&#x27;);\n    getServicesMatchingFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getServicesMatchingFromProfile&#x27;);\n    getContractMatchingFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getContractMatchingFromProfile&#x27;);\n    getConfigurationsFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getConfigurationsFromProfile&#x27;);\n    addConfigurationsToProfileSpy = sinon_1.default.spy(requestHandler, &#x27;addConfigurationsToProfile&#x27;);\n    updateConfigurationsForProfileSpy = sinon_1.default.spy(requestHandler, &#x27;updateConfigurationsForProfile&#x27;);\n    removeConfigurationsFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;removeConfigurationsFromProfile&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;aa4c8d93-2de1-4817-9ce0-1850d94d98b0&quot;,&quot;parentUUID&quot;:&quot;d02517dc-9213-48b1-8a69-1e4d742067c8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;ContractAgent Router Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests \&quot;after all\&quot; hook in \&quot;ContractAgent Router Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;getPoliciesRecommendationFromProfileSpy.restore();\ngetServicesRecommendationFromProfileSpy.restore();\ngetPoliciesMatchingFromProfileSpy.restore();\ngetServicesMatchingFromProfileSpy.restore();\ngetContractMatchingFromProfileSpy.restore();\ngetConfigurationsFromProfileSpy.restore();\naddConfigurationsToProfileSpy.restore();\nupdateConfigurationsForProfileSpy.restore();\nremoveConfigurationsFromProfileSpy.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b7649943-dc2f-437f-b3e2-9022df211b81&quot;,&quot;parentUUID&quot;:&quot;d02517dc-9213-48b1-8a69-1e4d742067c8&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get policies recommendations from profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should get policies recommendations from profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:34,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const response = yield (0, supertest_1.default)(app)\n        .get(`/api/profile/${profileURI}/policies-recommendations`)\n        .expect(200);\n    sinon_1.default.assert.calledOnce(getPoliciesRecommendationFromProfileSpy);\n    sinon_1.default.assert.calledWith(getPoliciesRecommendationFromProfileSpy, profileURI);\n    (0, chai_1.expect)(response.body).to.be.an(&#x27;array&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b1fde2d9-27bf-43af-81f2-34b8b4481918&quot;,&quot;parentUUID&quot;:&quot;d02517dc-9213-48b1-8a69-1e4d742067c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get services recommendations from profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should get services recommendations from profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const response = yield (0, supertest_1.default)(app)\n        .get(`/api/profile/${profileURI}/services-recommendations`)\n        .expect(200);\n    sinon_1.default.assert.calledOnce(getServicesRecommendationFromProfileSpy);\n    sinon_1.default.assert.calledWith(getServicesRecommendationFromProfileSpy, profileURI);\n    (0, chai_1.expect)(response.body).to.be.an(&#x27;array&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d9e09bc2-ceda-45a3-a1a5-c6dc8a9323fe&quot;,&quot;parentUUID&quot;:&quot;d02517dc-9213-48b1-8a69-1e4d742067c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get policies matching from profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should get policies matching from profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const response = yield (0, supertest_1.default)(app)\n        .get(`/api/profile/${profileURI}/policies-matching`)\n        .expect(200);\n    sinon_1.default.assert.calledOnce(getPoliciesMatchingFromProfileSpy);\n    sinon_1.default.assert.calledWith(getPoliciesMatchingFromProfileSpy, profileURI);\n    (0, chai_1.expect)(response.body).to.be.an(&#x27;array&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6015de06-b8f1-495f-a9df-14daebec4356&quot;,&quot;parentUUID&quot;:&quot;d02517dc-9213-48b1-8a69-1e4d742067c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle adding configurations to profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should handle adding configurations to profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:25,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const configurations = [{ configId: &#x27;config1&#x27; }];\n    const response = yield (0, supertest_1.default)(app)\n        .post(&#x27;/api/profile/configurations&#x27;)\n        .send({ profileURI, configurations })\n        .expect(201);\n    sinon_1.default.assert.calledOnce(addConfigurationsToProfileSpy);\n    sinon_1.default.assert.calledWith(addConfigurationsToProfileSpy, profileURI, configurations);\n    (0, chai_1.expect)(response.body).to.have.property(&#x27;success&#x27;, true);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8047de84-4043-4004-b987-0dc6239e2c9a&quot;,&quot;parentUUID&quot;:&quot;d02517dc-9213-48b1-8a69-1e4d742067c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle updating configurations for profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should handle updating configurations for profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:9,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const configurations = [{ configId: &#x27;config2&#x27; }];\n    const response = yield (0, supertest_1.default)(app)\n        .put(`/api/profile/${profileURI}/configurations`)\n        .send({ configurations })\n        .expect(200);\n    sinon_1.default.assert.calledOnce(updateConfigurationsForProfileSpy);\n    sinon_1.default.assert.calledWith(updateConfigurationsForProfileSpy, profileURI, configurations);\n    (0, chai_1.expect)(response.body).to.have.property(&#x27;success&#x27;, true);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f127e11f-ffbe-469c-a13f-1e1520e8e452&quot;,&quot;parentUUID&quot;:&quot;d02517dc-9213-48b1-8a69-1e4d742067c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle deleting configurations from profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should handle deleting configurations from profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const response = yield (0, supertest_1.default)(app)\n        .delete(`/api/profile/${profileURI}/configurations`)\n        .expect(200);\n    sinon_1.default.assert.calledOnce(removeConfigurationsFromProfileSpy);\n    sinon_1.default.assert.calledWith(removeConfigurationsFromProfileSpy, profileURI);\n    (0, chai_1.expect)(response.body).to.have.property(&#x27;success&#x27;, true);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6eac6bfe-3b61-4773-bf4b-f5a51ed1937d&quot;,&quot;parentUUID&quot;:&quot;d02517dc-9213-48b1-8a69-1e4d742067c8&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b1fde2d9-27bf-43af-81f2-34b8b4481918&quot;,&quot;d9e09bc2-ceda-45a3-a1a5-c6dc8a9323fe&quot;,&quot;6015de06-b8f1-495f-a9df-14daebec4356&quot;,&quot;8047de84-4043-4004-b987-0dc6239e2c9a&quot;,&quot;f127e11f-ffbe-469c-a13f-1e1520e8e452&quot;,&quot;6eac6bfe-3b61-4773-bf4b-f5a51ed1937d&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:89,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;72d2f4e4-aa3b-445f-b19f-d480be9ebac2&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.0.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;53b6a0ee-eb01-4c20-8dc8-c1a77270bf00&quot;,&quot;title&quot;:&quot;Contract Agent Test Cases&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.0.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;Contract Agent Test Cases\&quot;&quot;,&quot;fullTitle&quot;:&quot;Contract Agent Test Cases \&quot;before all\&quot; hook in \&quot;Contract Agent Test Cases\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:36,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    Agent_1.Agent.setConfigPath(&#x27;./mocks/contract-agent.config.json&#x27;, __filename);\n    contractAgent = yield ContractAgent_1.ContractAgent.retrieveService();\n    contractProvider = contractAgent.getDataProvider(&#x27;contracts&#x27;);\n    updateProfileFromContractChangeSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfileFromContractChange&#x27;);\n    updateProfilesForMembersSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfilesForMembers&#x27;);\n    updateProfilesForServiceOfferingsSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfilesForServiceOfferings&#x27;);\n    updateProfileForOrchestratorSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfileForOrchestrator&#x27;);\n    updateProfileSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfile&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e671d491-a527-4396-9ebd-88687d09de17&quot;,&quot;parentUUID&quot;:&quot;53b6a0ee-eb01-4c20-8dc8-c1a77270bf00&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;Contract Agent Test Cases\&quot;&quot;,&quot;fullTitle&quot;:&quot;Contract Agent Test Cases \&quot;after all\&quot; hook in \&quot;Contract Agent Test Cases\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    updateProfileFromContractChangeSpy.restore();\n    updateProfilesForMembersSpy.restore();\n    updateProfilesForServiceOfferingsSpy.restore();\n    updateProfileForOrchestratorSpy.restore();\n    updateProfileSpy.restore();\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8aa2d4c4-48a8-4056-ac9c-8124e014d73d&quot;,&quot;parentUUID&quot;:&quot;53b6a0ee-eb01-4c20-8dc8-c1a77270bf00&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should verify the flow for creating a contract and updating profiles&quot;,&quot;fullTitle&quot;:&quot;Contract Agent Test Cases should verify the flow for creating a contract and updating profiles&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:123,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    createdDocument = yield contractProvider.create(contract_mock_1.ContractBase);\n    (0, chai_1.expect)(createdDocument).to.have.property(&#x27;_id&#x27;);\n    yield delay(100);\n    yield new Promise(setImmediate);\n    sinon_1.default.assert.calledOnce(updateProfileFromContractChangeSpy);\n    (0, chai_1.expect)(updateProfileFromContractChangeSpy.calledOnce).to.be.true;\n    sinon_1.default.assert.calledOnce(updateProfilesForMembersSpy);\n    sinon_1.default.assert.calledOnce(updateProfilesForServiceOfferingsSpy);\n    sinon_1.default.assert.calledOnce(updateProfileForOrchestratorSpy);\n    sinon_1.default.assert.callCount(updateProfileSpy, contract_mock_1.ContractBase.members.length + contract_mock_1.ContractBase.serviceOfferings.length + 1);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;1eb23396-99ac-411e-99a6-7e6b1eed1c33&quot;,&quot;parentUUID&quot;:&quot;53b6a0ee-eb01-4c20-8dc8-c1a77270bf00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should delete the previously created contract successfully&quot;,&quot;fullTitle&quot;:&quot;Contract Agent Test Cases should delete the previously created contract successfully&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:5,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    (0, chai_1.expect)(createdDocument).to.not.be.undefined;\n    const deleteResult = yield contractProvider.delete(createdDocument._id.toString());\n    (0, chai_1.expect)(deleteResult).to.be.true;\n    const secondDeleteResult = yield contractProvider.delete(createdDocument._id.toString());\n    (0, chai_1.expect)(secondDeleteResult).to.be.false;\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;24521e40-5f5f-424e-b35d-e62634b89962&quot;,&quot;parentUUID&quot;:&quot;53b6a0ee-eb01-4c20-8dc8-c1a77270bf00&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;1eb23396-99ac-411e-99a6-7e6b1eed1c33&quot;,&quot;24521e40-5f5f-424e-b35d-e62634b89962&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:128,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;857b369f-6fd8-4001-a1d0-914c16a43661&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;66a7368a-ef07-4556-aa78-e7c2fe8d7f67&quot;,&quot;title&quot;:&quot;Negotiation Service Test Cases&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;Negotiation Service Test Cases\&quot;&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases \&quot;before each\&quot; hook in \&quot;Negotiation Service Test Cases\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;negotiationService = NegotiationService_1.NegotiationService.retrieveService(true);\nprofile = new Profile_1.Profile({\n    uri: &#x27;test-uri&#x27;,\n    configurations: {\n        allowPolicies: true,\n        allowRecommendations: true,\n    },\n    preference: [\n        {\n            policies: [\n                { policy: &#x27;allowed-policy&#x27;, frequency: 1 },\n                { policy: &#x27;another-policy&#x27;, frequency: 1 },\n            ],\n            services: [&#x27;allowed-service&#x27;],\n            ecosystems: [&#x27;test-ecosystem&#x27;],\n        },\n    ],\n    recommendations: [],\n    matching: [],\n});\ncontract = new Contract_1.Contract({\n    ecosystem: &#x27;test-ecosystem&#x27;,\n    status: &#x27;active&#x27;,\n    serviceOfferings: [\n        {\n            participant: &#x27;test-participant&#x27;,\n            serviceOffering: &#x27;allowed-service&#x27;,\n            policies: [\n                {\n                    description: &#x27;allowed-policy&#x27;,\n                    permission: [],\n                    prohibition: [],\n                },\n            ],\n        },\n    ],\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    members: [],\n    orchestrator: &#x27;&#x27;,\n    purpose: [],\n    revokedMembers: [],\n    rolesAndObligations: [],\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;49a75ed7-714f-4819-a3b6-f068e26721a6&quot;,&quot;parentUUID&quot;:&quot;66a7368a-ef07-4556-aa78-e7c2fe8d7f67&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;5dd583b6-0ab0-4f81-81d7-982643a6f3ad&quot;,&quot;title&quot;:&quot;isPolicyAcceptable&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept allowed policy&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isPolicyAcceptable should accept allowed policy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const policy = {\n    description: &#x27;allowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n};\n(0, chai_1.expect)(negotiationService.isPolicyAcceptable(profile, policy)).to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3dc805ba-163b-463e-80b0-c1e41c96f578&quot;,&quot;parentUUID&quot;:&quot;5dd583b6-0ab0-4f81-81d7-982643a6f3ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject disallowed policy&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isPolicyAcceptable should reject disallowed policy&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const policy = {\n    description: &#x27;disallowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n};\n(0, chai_1.expect)(negotiationService.isPolicyAcceptable(profile, policy)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5789eba0-814a-408a-bdbc-836ea46317a3&quot;,&quot;parentUUID&quot;:&quot;5dd583b6-0ab0-4f81-81d7-982643a6f3ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject all policies when allowPolicies is false&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isPolicyAcceptable should reject all policies when allowPolicies is false&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;profile.configurations.allowPolicies = false;\nconst policy = {\n    description: &#x27;allowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n};\n(0, chai_1.expect)(negotiationService.isPolicyAcceptable(profile, policy)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d32bb22a-fcde-409f-98c0-498ee861bf58&quot;,&quot;parentUUID&quot;:&quot;5dd583b6-0ab0-4f81-81d7-982643a6f3ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should check policy frequency&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isPolicyAcceptable should check policy frequency&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;profile.preference[0].policies[0].frequency = 0;\nconst policy = {\n    description: &#x27;allowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n};\n(0, chai_1.expect)(negotiationService.isPolicyAcceptable(profile, policy)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;96ad3481-5258-45d9-9cae-6e7f782caee3&quot;,&quot;parentUUID&quot;:&quot;5dd583b6-0ab0-4f81-81d7-982643a6f3ad&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;3dc805ba-163b-463e-80b0-c1e41c96f578&quot;,&quot;5789eba0-814a-408a-bdbc-836ea46317a3&quot;,&quot;d32bb22a-fcde-409f-98c0-498ee861bf58&quot;,&quot;96ad3481-5258-45d9-9cae-6e7f782caee3&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;672235b1-c539-4f68-a4d0-cd5ef9f51e13&quot;,&quot;title&quot;:&quot;isServiceAcceptable&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept allowed service&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isServiceAcceptable should accept allowed service&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const service = {\n    participant: &#x27;test&#x27;,\n    serviceOffering: &#x27;allowed-service&#x27;,\n    policies: [],\n};\n(0, chai_1.expect)(negotiationService.isServiceAcceptable(profile, service)).to.be\n    .true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e9baff3a-7ce5-4cd9-921d-37e0cdc65d3a&quot;,&quot;parentUUID&quot;:&quot;672235b1-c539-4f68-a4d0-cd5ef9f51e13&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject disallowed service&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases isServiceAcceptable should reject disallowed service&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const service = {\n    participant: &#x27;test&#x27;,\n    serviceOffering: &#x27;disallowed-service&#x27;,\n    policies: [],\n};\n(0, chai_1.expect)(negotiationService.isServiceAcceptable(profile, service)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;cabd33ca-3ef8-43fc-b9aa-b65ca026e4fe&quot;,&quot;parentUUID&quot;:&quot;672235b1-c539-4f68-a4d0-cd5ef9f51e13&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;e9baff3a-7ce5-4cd9-921d-37e0cdc65d3a&quot;,&quot;cabd33ca-3ef8-43fc-b9aa-b65ca026e4fe&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;21d31c15-21fc-4ac4-96d4-c1f9ff3648fe&quot;,&quot;title&quot;:&quot;canAcceptContract&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept valid contract&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases canAcceptContract should accept valid contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;(0, chai_1.expect)(negotiationService.canAcceptContract(profile, contract)).to.be\n    .true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;27e53979-e40f-46c0-97a3-50e1fc7840b1&quot;,&quot;parentUUID&quot;:&quot;21d31c15-21fc-4ac4-96d4-c1f9ff3648fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject inactive contract&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases canAcceptContract should reject inactive contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.status = &#x27;inactive&#x27;;\n(0, chai_1.expect)(negotiationService.canAcceptContract(profile, contract)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;07b7d5f3-a948-4bd6-aebe-b4af9ca8d148&quot;,&quot;parentUUID&quot;:&quot;21d31c15-21fc-4ac4-96d4-c1f9ff3648fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject contract with unacceptable service offering&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases canAcceptContract should reject contract with unacceptable service offering&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.serviceOfferings[0].serviceOffering = &#x27;disallowed-service&#x27;;\n(0, chai_1.expect)(negotiationService.canAcceptContract(profile, contract)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3ac314a4-1898-4105-b62f-66188b271d89&quot;,&quot;parentUUID&quot;:&quot;21d31c15-21fc-4ac4-96d4-c1f9ff3648fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject contract with unacceptable policies&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases canAcceptContract should reject contract with unacceptable policies&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.serviceOfferings[0].policies.push({\n    description: &#x27;disallowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n});\n(0, chai_1.expect)(negotiationService.canAcceptContract(profile, contract)).to.be\n    .false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;9d157a9a-1b42-453c-8864-a708549169ac&quot;,&quot;parentUUID&quot;:&quot;21d31c15-21fc-4ac4-96d4-c1f9ff3648fe&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;27e53979-e40f-46c0-97a3-50e1fc7840b1&quot;,&quot;07b7d5f3-a948-4bd6-aebe-b4af9ca8d148&quot;,&quot;3ac314a4-1898-4105-b62f-66188b271d89&quot;,&quot;9d157a9a-1b42-453c-8864-a708549169ac&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;fd7e3aa7-8ce5-45df-a050-5765c5c9f1be&quot;,&quot;title&quot;:&quot;negotiateContract&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return successful negotiation for valid contract&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases negotiateContract should return successful negotiation for valid contract&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const result = negotiationService.negotiateContract(profile, contract);\n(0, chai_1.expect)(result.canAccept).to.be.true;\n(0, chai_1.expect)(result.reason).to.be.undefined;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4b96b954-2a62-414c-b827-6b044cd9a497&quot;,&quot;parentUUID&quot;:&quot;fd7e3aa7-8ce5-45df-a050-5765c5c9f1be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return failed negotiation with unacceptable policies&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases negotiateContract should return failed negotiation with unacceptable policies&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.serviceOfferings[0].policies.push({\n    description: &#x27;disallowed-policy&#x27;,\n    permission: [],\n    prohibition: [],\n});\nconst result = negotiationService.negotiateContract(profile, contract);\n(0, chai_1.expect)(result.canAccept).to.be.false;\n(0, chai_1.expect)(result.unacceptablePolicies).to.include(&#x27;disallowed-policy&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;55adeddb-df8e-4d63-a4d9-77aba8d126fc&quot;,&quot;parentUUID&quot;:&quot;fd7e3aa7-8ce5-45df-a050-5765c5c9f1be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return failed negotiation with unacceptable services&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases negotiateContract should return failed negotiation with unacceptable services&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.serviceOfferings[0].serviceOffering = &#x27;disallowed-service&#x27;;\nconst result = negotiationService.negotiateContract(profile, contract);\n(0, chai_1.expect)(result.canAccept).to.be.false;\n(0, chai_1.expect)(result.unacceptableServices).to.include(&#x27;disallowed-service&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;3db289de-96d1-4d77-bc5a-d93d16aaa9a1&quot;,&quot;parentUUID&quot;:&quot;fd7e3aa7-8ce5-45df-a050-5765c5c9f1be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle errors during negotiation&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases negotiateContract should handle errors during negotiation&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const corruptedContract = null;\nconst result = negotiationService.negotiateContract(profile, corruptedContract);\n(0, chai_1.expect)(result.canAccept).to.be.false;\n(0, chai_1.expect)(result.reason).to.equal(&#x27;An error occurred during negotiation.&#x27;);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f6750d98-6cba-4b71-b2f9-24e7b86f72c6&quot;,&quot;parentUUID&quot;:&quot;fd7e3aa7-8ce5-45df-a050-5765c5c9f1be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should identify multiple unacceptable policies and services&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases negotiateContract should identify multiple unacceptable policies and services&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;contract.serviceOfferings = [\n    {\n        participant: &#x27;test&#x27;,\n        serviceOffering: &#x27;disallowed-service-1&#x27;,\n        policies: [\n            {\n                description: &#x27;disallowed-policy-1&#x27;,\n                permission: [],\n                prohibition: [],\n            },\n        ],\n    },\n    {\n        participant: &#x27;test&#x27;,\n        serviceOffering: &#x27;disallowed-service-2&#x27;,\n        policies: [\n            {\n                description: &#x27;disallowed-policy-2&#x27;,\n                permission: [],\n                prohibition: [],\n            },\n        ],\n    },\n];\nconst result = negotiationService.negotiateContract(profile, contract);\n(0, chai_1.expect)(result.canAccept).to.be.false;\n(0, chai_1.expect)(result.unacceptablePolicies).to.have.members([\n    &#x27;disallowed-policy-1&#x27;,\n    &#x27;disallowed-policy-2&#x27;,\n]);\n(0, chai_1.expect)(result.unacceptableServices).to.have.members([\n    &#x27;disallowed-service-1&#x27;,\n    &#x27;disallowed-service-2&#x27;,\n]);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;4d6bbb00-fa50-45ac-a9ec-cb71b4276a32&quot;,&quot;parentUUID&quot;:&quot;fd7e3aa7-8ce5-45df-a050-5765c5c9f1be&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;4b96b954-2a62-414c-b827-6b044cd9a497&quot;,&quot;55adeddb-df8e-4d63-a4d9-77aba8d126fc&quot;,&quot;3db289de-96d1-4d77-bc5a-d93d16aaa9a1&quot;,&quot;f6750d98-6cba-4b71-b2f9-24e7b86f72c6&quot;,&quot;4d6bbb00-fa50-45ac-a9ec-cb71b4276a32&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:3,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;7a483ba9-b97d-4c32-aab8-4c68d5b85796&quot;,&quot;title&quot;:&quot;areServicePoliciesAcceptable&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should accept service with acceptable policies&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases areServicePoliciesAcceptable should accept service with acceptable policies&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const service = {\n    participant: &#x27;test&#x27;,\n    serviceOffering: &#x27;allowed-service&#x27;,\n    policies: [\n        {\n            description: &#x27;allowed-policy&#x27;,\n            permission: [],\n            prohibition: [],\n        },\n    ],\n};\n(0, chai_1.expect)(negotiationService.areServicePoliciesAcceptable(profile, service))\n    .to.be.true;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b85883a7-1b77-4773-9d58-adda306367ed&quot;,&quot;parentUUID&quot;:&quot;7a483ba9-b97d-4c32-aab8-4c68d5b85796&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should reject service with unacceptable policies&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases areServicePoliciesAcceptable should reject service with unacceptable policies&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const service = {\n    participant: &#x27;test&#x27;,\n    serviceOffering: &#x27;allowed-service&#x27;,\n    policies: [\n        {\n            description: &#x27;disallowed-policy&#x27;,\n            permission: [],\n            prohibition: [],\n        },\n    ],\n};\n(0, chai_1.expect)(negotiationService.areServicePoliciesAcceptable(profile, service))\n    .to.be.false;&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;f3ad3c70-819a-43e7-acec-091c55f18b4a&quot;,&quot;parentUUID&quot;:&quot;7a483ba9-b97d-4c32-aab8-4c68d5b85796&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;b85883a7-1b77-4773-9d58-adda306367ed&quot;,&quot;f3ad3c70-819a-43e7-acec-091c55f18b4a&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;818a9c42-8fe7-4c02-afa2-9efdee7619a4&quot;,&quot;title&quot;:&quot;updateProfilePreferences&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should add valid preferences&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases updateProfilePreferences should add valid preferences&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const newPreferences = [\n    {\n        policies: [{ policy: &#x27;new-policy&#x27;, frequency: 1 }],\n        services: [&#x27;new-service&#x27;],\n        ecosystems: [&#x27;new-ecosystem&#x27;],\n    },\n];\nconst initialLength = profile.preference.length;\nnegotiationService.updateProfilePreferences(profile, newPreferences);\n(0, chai_1.expect)(profile.preference.length).to.equal(initialLength + 1);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;10819a91-8dbd-4f9f-bd23-9330abe0f406&quot;,&quot;parentUUID&quot;:&quot;818a9c42-8fe7-4c02-afa2-9efdee7619a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should filter out invalid preferences&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases updateProfilePreferences should filter out invalid preferences&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const invalidPreferences = [\n    undefined,\n    null,\n    { policies: null, services: [], ecosystems: [] },\n];\nconst initialLength = profile.preference.length;\nnegotiationService.updateProfilePreferences(profile, invalidPreferences);\n(0, chai_1.expect)(profile.preference.length).to.equal(initialLength);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;fb5b1b3a-f06c-4b40-ba31-7d5568d02fcf&quot;,&quot;parentUUID&quot;:&quot;818a9c42-8fe7-4c02-afa2-9efdee7619a4&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;10819a91-8dbd-4f9f-bd23-9330abe0f406&quot;,&quot;fb5b1b3a-f06c-4b40-ba31-7d5568d02fcf&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:1,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;4c17a0de-3eff-47cd-aa5c-757a83a87471&quot;,&quot;title&quot;:&quot;NegotiationService Singleton&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.1.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[{&quot;title&quot;:&quot;should return the same instance without refresh&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases NegotiationService Singleton should return the same instance without refresh&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const instance1 = NegotiationService_1.NegotiationService.retrieveService();\nconst instance2 = NegotiationService_1.NegotiationService.retrieveService();\n(0, chai_1.expect)(instance1).to.equal(instance2);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0bed778b-83f1-4a63-9de3-88957b6aff02&quot;,&quot;parentUUID&quot;:&quot;4c17a0de-3eff-47cd-aa5c-757a83a87471&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should return a new instance with refresh&quot;,&quot;fullTitle&quot;:&quot;Negotiation Service Test Cases NegotiationService Singleton should return a new instance with refresh&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;const instance1 = NegotiationService_1.NegotiationService.retrieveService();\nconst instance2 = NegotiationService_1.NegotiationService.retrieveService(true);\n(0, chai_1.expect)(instance1).to.not.equal(instance2);&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5fe24d29-4720-4aca-9aac-816c4adbbe08&quot;,&quot;parentUUID&quot;:&quot;4c17a0de-3eff-47cd-aa5c-757a83a87471&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;0bed778b-83f1-4a63-9de3-88957b6aff02&quot;,&quot;5fe24d29-4720-4aca-9aac-816c4adbbe08&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;afde615c-b549-4e9c-be8a-b4870426a4d4&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.3.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.3.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;8593231a-299c-4296-8a6f-f619059bd6cb&quot;,&quot;title&quot;:&quot;MongooseProvider Events Tests&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.3.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.3.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests \&quot;before all\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:39,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        provider = new MongooseProvider_1.MongooseProvider({\n            source: &#x27;contracts&#x27;,\n            url: &#x27;mongodb://localhost:27017&#x27;,\n            dbName: &#x27;test&#x27;,\n        });\n        provider.on(&#x27;dataInserted&#x27;, (event) =&gt; {\n            dataInsertedEventReceived = true;\n            dataInsertedPayload = event;\n        });\n        provider.on(&#x27;dataUpdated&#x27;, (event) =&gt; {\n            dataUpdatedEventReceived = true;\n            dataUpdatedPayload = event;\n        });\n        provider.on(&#x27;dataDeleted&#x27;, (event) =&gt; {\n            dataDeletedEventReceived = true;\n            dataDeletedPayload = event;\n        });\n        model = yield contract_model_mock_1.default.getModel();\n        yield provider.ensureReady();\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;d1491296-df8f-404c-8afd-cded14ed982c&quot;,&quot;parentUUID&quot;:&quot;8593231a-299c-4296-8a6f-f619059bd6cb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;\&quot;before each\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests \&quot;before each\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:7,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        dataInsertedEventReceived = false;\n        dataInsertedPayload = null;\n        dataUpdatedEventReceived = false;\n        dataUpdatedPayload = null;\n        dataDeletedEventReceived = false;\n        dataDeletedPayload = null;\n        yield model.deleteMany({});\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8095c723-97a2-49c4-8fa2-7d007aa60dfe&quot;,&quot;parentUUID&quot;:&quot;8593231a-299c-4296-8a6f-f619059bd6cb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests \&quot;after all\&quot; hook in \&quot;MongooseProvider Events Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:63,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        yield model.deleteMany({});\n        yield mongoose_1.default.disconnect();\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;295a14c0-cbf3-46c4-b4a3-cefe246167b0&quot;,&quot;parentUUID&quot;:&quot;8593231a-299c-4296-8a6f-f619059bd6cb&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should emit dataInserted event when saving a new document&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests should emit dataInserted event when saving a new document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:124,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        const contractData = {\n            uid: &#x27;test-contract-1&#x27;,\n            profile: &#x27;test-profile&#x27;,\n            ecosystem: &#x27;test-ecosystem&#x27;,\n            orchestrator: &#x27;test-orchestrator&#x27;,\n            members: [\n                {\n                    participant: &#x27;test-participant&#x27;,\n                    role: &#x27;test-role&#x27;,\n                    signature: &#x27;test-signature&#x27;,\n                },\n            ],\n            status: &#x27;pending&#x27;,\n            serviceOfferings: [],\n            rolesAndObligations: [],\n            purpose: [],\n            revokedMembers: [],\n        };\n        const contract = new model(contractData);\n        yield contract.save();\n        yield new Promise((resolve) =&gt; setTimeout(resolve, 100));\n        (0, chai_1.expect)(dataInsertedEventReceived).to.be.true;\n        (0, chai_1.expect)(dataInsertedPayload).to.exist;\n        (0, chai_1.expect)(dataInsertedPayload.source).to.equal(&#x27;contracts&#x27;);\n        (0, chai_1.expect)(dataInsertedPayload.fullDocument).to.exist;\n        (0, chai_1.expect)(dataInsertedPayload.fullDocument.uid).to.equal(contractData.uid);\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2a885e81-3e39-46b0-93df-10da5b9f648c&quot;,&quot;parentUUID&quot;:&quot;8593231a-299c-4296-8a6f-f619059bd6cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit dataInserted event when creating via model.create()&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests should emit dataInserted event when creating via model.create()&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:127,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        const contractData = {\n            uid: &#x27;test-contract-1&#x27;,\n            profile: &#x27;test-profile&#x27;,\n            ecosystem: &#x27;test-ecosystem&#x27;,\n            orchestrator: &#x27;test-orchestrator&#x27;,\n            members: [\n                {\n                    participant: &#x27;test-participant&#x27;,\n                    role: &#x27;test-role&#x27;,\n                    signature: &#x27;test-signature&#x27;,\n                },\n            ],\n            status: &#x27;pending&#x27;,\n            serviceOfferings: [],\n            rolesAndObligations: [],\n            purpose: [],\n            revokedMembers: [],\n        };\n        yield model.create(contractData);\n        yield new Promise((resolve) =&gt; setTimeout(resolve, 100));\n        (0, chai_1.expect)(dataInsertedEventReceived).to.be.true;\n        (0, chai_1.expect)(dataInsertedPayload).to.exist;\n        (0, chai_1.expect)(dataInsertedPayload.source).to.equal(&#x27;contracts&#x27;);\n        (0, chai_1.expect)(dataInsertedPayload.fullDocument.uid).to.equal(contractData.uid);\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8e5fec45-124b-486c-b4fd-6496029d8462&quot;,&quot;parentUUID&quot;:&quot;8593231a-299c-4296-8a6f-f619059bd6cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit dataUpdated event when updating via model.updateOne()&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests should emit dataUpdated event when updating via model.updateOne()&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:145,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        const contract = yield model.create({\n            uid: &#x27;test-contract-2&#x27;,\n            profile: &#x27;old-profile&#x27;,\n            ecosystem: &#x27;test-ecosystem&#x27;,\n            orchestrator: &#x27;test-orchestrator&#x27;,\n            status: &#x27;pending&#x27;,\n        });\n        yield model.updateOne({ _id: contract._id }, { $set: { profile: &#x27;new-profile&#x27; } });\n        yield new Promise((resolve) =&gt; setTimeout(resolve, 100));\n        (0, chai_1.expect)(dataUpdatedEventReceived).to.be.true;\n        (0, chai_1.expect)(dataUpdatedPayload).to.exist;\n        (0, chai_1.expect)(dataUpdatedPayload.source).to.equal(&#x27;contracts&#x27;);\n        (0, chai_1.expect)(dataUpdatedPayload.updateDescription).to.exist;\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;5d44c497-7a35-4846-b3db-b3f4bf9b924b&quot;,&quot;parentUUID&quot;:&quot;8593231a-299c-4296-8a6f-f619059bd6cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit dataDeleted event when deleting via model.deleteOne()&quot;,&quot;fullTitle&quot;:&quot;MongooseProvider Events Tests should emit dataDeleted event when deleting via model.deleteOne()&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:132,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;__awaiter(void 0, void 0, void 0, function* () {\n        const contract = yield model.create({\n            uid: &#x27;test-contract-3&#x27;,\n            profile: &#x27;test-profile&#x27;,\n            ecosystem: &#x27;test-ecosystem&#x27;,\n            orchestrator: &#x27;test-orchestrator&#x27;,\n            status: &#x27;pending&#x27;,\n        });\n        yield model.deleteOne({ _id: contract._id });\n        yield new Promise((resolve) =&gt; setTimeout(resolve, 100));\n        (0, chai_1.expect)(dataDeletedEventReceived).to.be.true;\n        (0, chai_1.expect)(dataDeletedPayload).to.exist;\n        (0, chai_1.expect)(dataDeletedPayload.source).to.equal(&#x27;contracts&#x27;);\n        (0, chai_1.expect)(dataDeletedPayload.documentKey).to.exist;\n    })&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;61de4b99-d20c-48fa-9c75-d1d1d0e7b528&quot;,&quot;parentUUID&quot;:&quot;8593231a-299c-4296-8a6f-f619059bd6cb&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;2a885e81-3e39-46b0-93df-10da5b9f648c&quot;,&quot;8e5fec45-124b-486c-b4fd-6496029d8462&quot;,&quot;5d44c497-7a35-4846-b3db-b3f4bf9b924b&quot;,&quot;61de4b99-d20c-48fa-9c75-d1d1d0e7b528&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:528,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;1fc82444-3d20-462e-a134-c4030a888d6d&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.4.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.4.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;88d314d2-968c-4e11-98ee-058dbd885067&quot;,&quot;title&quot;:&quot;ContractAgent with MongooseProvider&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.agent.4.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.agent.4.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;ContractAgent with MongooseProvider\&quot;&quot;,&quot;fullTitle&quot;:&quot;ContractAgent with MongooseProvider \&quot;before all\&quot; hook in \&quot;ContractAgent with MongooseProvider\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:42,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    Agent_1.Agent.setConfigPath(&#x27;./mocks/contract-agent.config.json&#x27;, __filename);\n    model = yield contract_model_mock_1.default.getModel();\n    agent = yield ContractAgent_1.ContractAgent.retrieveService(MongooseProvider_1.MongooseProvider);\n    updateProfileFromContractChangeSpy = sinon_1.default.spy(ContractAgent_1.ContractAgent.prototype, &#x27;updateProfileFromContractChange&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;8c5fb618-ada4-4bf2-9d68-cae5cab4dc06&quot;,&quot;parentUUID&quot;:&quot;88d314d2-968c-4e11-98ee-058dbd885067&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;ContractAgent with MongooseProvider\&quot;&quot;,&quot;fullTitle&quot;:&quot;ContractAgent with MongooseProvider \&quot;after all\&quot; hook in \&quot;ContractAgent with MongooseProvider\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:1016,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    updateProfileFromContractChangeSpy.restore();\n    if (model) {\n        yield model.deleteMany({});\n    }\n    yield Promise.all([\n        mongoose_1.default.disconnect(),\n        new Promise((resolve) =&gt; setTimeout(resolve, 1000)),\n    ]);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;0f6dbd2a-f792-4b25-99ce-a5951895a709&quot;,&quot;parentUUID&quot;:&quot;88d314d2-968c-4e11-98ee-058dbd885067&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should initialize correctly and trigger handleDataInserted via create&quot;,&quot;fullTitle&quot;:&quot;ContractAgent with MongooseProvider should initialize correctly and trigger handleDataInserted via create&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:168,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    yield model.create({\n        ecosystem: &#x27;test-ecosystem&#x27;,\n        serviceOfferings: [\n            {\n                participant: &#x27;test-participant&#x27;,\n                serviceOffering: &#x27;allowed-service&#x27;,\n                policies: [\n                    {\n                        description: &#x27;allowed-policy&#x27;,\n                        permission: [],\n                        prohibition: [],\n                    },\n                ],\n            },\n        ],\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        members: [],\n        orchestrator: &#x27;&#x27;,\n        purpose: [],\n        revokedMembers: [],\n        rolesAndObligations: [],\n    });\n    yield delay(100);\n    yield new Promise(setImmediate);\n    sinon_1.default.assert.calledOnce(updateProfileFromContractChangeSpy);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;36f757c5-7524-4827-bb0c-c784ed2b1fd4&quot;,&quot;parentUUID&quot;:&quot;88d314d2-968c-4e11-98ee-058dbd885067&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should initialize correctly and trigger handleDataInserted via save&quot;,&quot;fullTitle&quot;:&quot;ContractAgent with MongooseProvider should initialize correctly and trigger handleDataInserted via save&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:122,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const contract = new model();\n    updateProfileFromContractChangeSpy.resetHistory();\n    yield contract.save({\n        ecosystem: &#x27;test-ecosystem&#x27;,\n        serviceOfferings: [\n            {\n                participant: &#x27;test-participant&#x27;,\n                serviceOffering: &#x27;allowed-service&#x27;,\n                policies: [\n                    {\n                        description: &#x27;allowed-policy&#x27;,\n                        permission: [],\n                        prohibition: [],\n                    },\n                ],\n            },\n        ],\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        members: [],\n        orchestrator: &#x27;&#x27;,\n        purpose: [],\n        revokedMembers: [],\n        rolesAndObligations: [],\n    });\n    yield delay(100);\n    yield new Promise(setImmediate);\n    sinon_1.default.assert.calledOnce(updateProfileFromContractChangeSpy);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c2ef9673-89a3-40ad-977e-2bd030ed3700&quot;,&quot;parentUUID&quot;:&quot;88d314d2-968c-4e11-98ee-058dbd885067&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should trigger updateProfileFromContractChange on update&quot;,&quot;fullTitle&quot;:&quot;ContractAgent with MongooseProvider should trigger updateProfileFromContractChange on update&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:141,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;slow&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const doc = yield model.create({\n        ecosystem: &#x27;test-ecosystem-update&#x27;,\n        serviceOfferings: [\n            {\n                participant: &#x27;test-participant-update&#x27;,\n                serviceOffering: &#x27;allowed-service&#x27;,\n                policies: [\n                    { description: &#x27;allowed-policy&#x27;, permission: [], prohibition: [] },\n                ],\n            },\n        ],\n        members: [],\n        orchestrator: &#x27;&#x27;,\n        purpose: [],\n        revokedMembers: [],\n        rolesAndObligations: [],\n    });\n    updateProfileFromContractChangeSpy.resetHistory();\n    yield model.findByIdAndUpdate(doc._id, {\n        $set: { ecosystem: &#x27;updated-ecosystem&#x27; },\n    });\n    yield delay(100);\n    yield new Promise(setImmediate);\n    sinon_1.default.assert.calledOnce(updateProfileFromContractChangeSpy);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;21f1bac6-efd5-4392-a5e2-19461cc89139&quot;,&quot;parentUUID&quot;:&quot;88d314d2-968c-4e11-98ee-058dbd885067&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;36f757c5-7524-4827-bb0c-c784ed2b1fd4&quot;,&quot;c2ef9673-89a3-40ad-977e-2bd030ed3700&quot;,&quot;21f1bac6-efd5-4392-a5e2-19461cc89139&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:431,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:10000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;7e28131f-35f1-41bd-ace1-f3b9e947d462&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.dataprovider.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.dataprovider.0.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;b8121f8f-1c0f-41ba-96f7-2fd787145c78&quot;,&quot;title&quot;:&quot;DataProvider Events Test Cases&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.dataprovider.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.dataprovider.0.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;DataProvider Events Test Cases\&quot;&quot;,&quot;fullTitle&quot;:&quot;DataProvider Events Test Cases \&quot;before all\&quot; hook in \&quot;DataProvider Events Test Cases\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:32,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const config = {\n        url: &#x27;mongodb://localhost:27017&#x27;,\n        dbName: &#x27;contract_consent_agent_db&#x27;,\n        source: collection,\n    };\n    mongoProvider = new MongoDBProvider_1.MongoDBProvider(config);\n    yield mongoProvider.ensureReady();\n    agentTest = new AgentTest(mongoProvider);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;021bb858-4d4f-4e0b-b752-5425c68a29c6&quot;,&quot;parentUUID&quot;:&quot;b8121f8f-1c0f-41ba-96f7-2fd787145c78&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after each\&quot; hook in \&quot;DataProvider Events Test Cases\&quot;&quot;,&quot;fullTitle&quot;:&quot;DataProvider Events Test Cases \&quot;after each\&quot; hook in \&quot;DataProvider Events Test Cases\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;agentTest.handleDataInsertedSpy.resetHistory();\nagentTest.handleDataUpdatedSpy.resetHistory();\nagentTest.handleDataDeletedSpy.resetHistory();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;66d6a3c4-cc57-4bf6-9005-a7753ee4f0ca&quot;,&quot;parentUUID&quot;:&quot;b8121f8f-1c0f-41ba-96f7-2fd787145c78&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should emit dataInserted event when creating a document&quot;,&quot;fullTitle&quot;:&quot;DataProvider Events Test Cases should emit dataInserted event when creating a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:16,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const testData = { name: &#x27;test&#x27;, value: 123 };\n    const result = yield mongoProvider.create(testData);\n    (0, chai_1.expect)(agentTest.handleDataInsertedSpy.calledOnce).to.be.true;\n    const eventData = agentTest.handleDataInsertedSpy.firstCall.args[0];\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;source&#x27;, collection);\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;fullDocument&#x27;);\n    (0, chai_1.expect)(eventData.fullDocument).to.include(testData);\n    if (result._id) {\n        yield mongoProvider.delete(result._id.toString());\n    }\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;80e633b0-24aa-4282-b6f9-4a0b95a43d11&quot;,&quot;parentUUID&quot;:&quot;b8121f8f-1c0f-41ba-96f7-2fd787145c78&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit dataUpdated event when updating a document&quot;,&quot;fullTitle&quot;:&quot;DataProvider Events Test Cases should emit dataUpdated event when updating a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const testData = { name: &#x27;test-update&#x27;, value: 456 };\n    const created = yield mongoProvider.create(testData);\n    agentTest.handleDataInsertedSpy.resetHistory();\n    const updateData = { value: 789 };\n    const criteria = {\n        conditions: [\n            {\n                field: &#x27;_id&#x27;,\n                operator: types_1.FilterOperator.EQUALS,\n                value: created._id,\n            },\n        ],\n        threshold: 0,\n    };\n    yield mongoProvider.update(criteria, updateData);\n    (0, chai_1.expect)(agentTest.handleDataUpdatedSpy.calledOnce).to.be.true;\n    const eventData = agentTest.handleDataUpdatedSpy.firstCall.args[0];\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;source&#x27;, collection);\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;documentKey&#x27;);\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;updateDescription&#x27;);\n    if (created._id) {\n        yield mongoProvider.delete(created._id.toString());\n    }\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;b3012f0f-5343-48e3-b64f-b4cdf26015a8&quot;,&quot;parentUUID&quot;:&quot;b8121f8f-1c0f-41ba-96f7-2fd787145c78&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should emit dataDeleted event when deleting a document&quot;,&quot;fullTitle&quot;:&quot;DataProvider Events Test Cases should emit dataDeleted event when deleting a document&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:3,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const testData = { name: &#x27;test-delete&#x27;, value: 999 };\n    const created = yield mongoProvider.create(testData);\n    agentTest.handleDataInsertedSpy.resetHistory();\n    if (created._id) {\n        yield mongoProvider.delete(created._id.toString());\n    }\n    (0, chai_1.expect)(agentTest.handleDataDeletedSpy.calledOnce).to.be.true;\n    const eventData = agentTest.handleDataDeletedSpy.firstCall.args[0];\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;source&#x27;, collection);\n    (0, chai_1.expect)(eventData).to.have.property(&#x27;documentKey&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;92656a9c-4497-4238-971d-5baa08792fc5&quot;,&quot;parentUUID&quot;:&quot;b8121f8f-1c0f-41ba-96f7-2fd787145c78&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;80e633b0-24aa-4282-b6f9-4a0b95a43d11&quot;,&quot;b3012f0f-5343-48e3-b64f-b4cdf26015a8&quot;,&quot;92656a9c-4497-4238-971d-5baa08792fc5&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:25,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000},{&quot;uuid&quot;:&quot;0699d004-2ecd-4083-b57b-572759112159&quot;,&quot;title&quot;:&quot;&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.router.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.router.0.spec.ts&quot;,&quot;beforeHooks&quot;:[],&quot;afterHooks&quot;:[],&quot;tests&quot;:[],&quot;suites&quot;:[{&quot;uuid&quot;:&quot;0f020892-adb8-4060-b149-120103cb1b50&quot;,&quot;title&quot;:&quot;ContractAgent Router Tests&quot;,&quot;fullFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\src\\tests\\contract.router.0.spec.ts&quot;,&quot;file&quot;:&quot;\\src\\tests\\contract.router.0.spec.ts&quot;,&quot;beforeHooks&quot;:[{&quot;title&quot;:&quot;\&quot;before all\&quot; hook in \&quot;ContractAgent Router Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests \&quot;before all\&quot; hook in \&quot;ContractAgent Router Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:48,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    var _a;\n    Agent_1.Agent.setConfigPath(&#x27;./mocks/contract-agent.config.json&#x27;, __filename);\n    requestHandler = yield ContractAgentHandler_1.RequestHandler.retrieveService();\n    const contractAgent = yield requestHandler.getContractAgent();\n    const profile = yield contractAgent.createProfileForParticipant(&#x27;some-participant-uri&#x27;);\n    profileURI = (_a = profile.uri) !== null &amp;&amp; _a !== void 0 ? _a : profileURI;\n    getPoliciesRecommendationFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getPoliciesRecommendationFromProfile&#x27;);\n    getServicesRecommendationFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getServicesRecommendationFromProfile&#x27;);\n    getPoliciesMatchingFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getPoliciesMatchingFromProfile&#x27;);\n    getServicesMatchingFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getServicesMatchingFromProfile&#x27;);\n    getContractMatchingFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getContractMatchingFromProfile&#x27;);\n    getConfigurationsFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;getConfigurationsFromProfile&#x27;);\n    addConfigurationsToProfileSpy = sinon_1.default.spy(requestHandler, &#x27;addConfigurationsToProfile&#x27;);\n    updateConfigurationsForProfileSpy = sinon_1.default.spy(requestHandler, &#x27;updateConfigurationsForProfile&#x27;);\n    removeConfigurationsFromProfileSpy = sinon_1.default.spy(requestHandler, &#x27;removeConfigurationsFromProfile&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;e37d8d58-4af0-4f2d-a358-18290df6414b&quot;,&quot;parentUUID&quot;:&quot;0f020892-adb8-4060-b149-120103cb1b50&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;afterHooks&quot;:[{&quot;title&quot;:&quot;\&quot;after all\&quot; hook in \&quot;ContractAgent Router Tests\&quot;&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests \&quot;after all\&quot; hook in \&quot;ContractAgent Router Tests\&quot;&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:0,&quot;state&quot;:null,&quot;speed&quot;:null,&quot;pass&quot;:false,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;getPoliciesRecommendationFromProfileSpy.restore();\ngetServicesRecommendationFromProfileSpy.restore();\ngetPoliciesMatchingFromProfileSpy.restore();\ngetServicesMatchingFromProfileSpy.restore();\ngetContractMatchingFromProfileSpy.restore();\ngetConfigurationsFromProfileSpy.restore();\naddConfigurationsToProfileSpy.restore();\nupdateConfigurationsForProfileSpy.restore();\nremoveConfigurationsFromProfileSpy.restore();&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;74dd8862-5a94-45ea-a1e1-226095046737&quot;,&quot;parentUUID&quot;:&quot;0f020892-adb8-4060-b149-120103cb1b50&quot;,&quot;isHook&quot;:true,&quot;skipped&quot;:false}],&quot;tests&quot;:[{&quot;title&quot;:&quot;should get policies recommendations from profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should get policies recommendations from profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:33,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const response = yield (0, supertest_1.default)(app)\n        .get(`/api/profile/${profileURI}/policies-recommendations`)\n        .expect(200);\n    sinon_1.default.assert.calledOnce(getPoliciesRecommendationFromProfileSpy);\n    sinon_1.default.assert.calledWith(getPoliciesRecommendationFromProfileSpy, profileURI);\n    (0, chai_1.expect)(response.body).to.be.an(&#x27;array&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;6b988895-9806-4979-8e7f-de24c98b231d&quot;,&quot;parentUUID&quot;:&quot;0f020892-adb8-4060-b149-120103cb1b50&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get services recommendations from profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should get services recommendations from profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const response = yield (0, supertest_1.default)(app)\n        .get(`/api/profile/${profileURI}/services-recommendations`)\n        .expect(200);\n    sinon_1.default.assert.calledOnce(getServicesRecommendationFromProfileSpy);\n    sinon_1.default.assert.calledWith(getServicesRecommendationFromProfileSpy, profileURI);\n    (0, chai_1.expect)(response.body).to.be.an(&#x27;array&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;91677dfe-69be-4aa6-ab13-120fbd2701d8&quot;,&quot;parentUUID&quot;:&quot;0f020892-adb8-4060-b149-120103cb1b50&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should get policies matching from profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should get policies matching from profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:6,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const response = yield (0, supertest_1.default)(app)\n        .get(`/api/profile/${profileURI}/policies-matching`)\n        .expect(200);\n    sinon_1.default.assert.calledOnce(getPoliciesMatchingFromProfileSpy);\n    sinon_1.default.assert.calledWith(getPoliciesMatchingFromProfileSpy, profileURI);\n    (0, chai_1.expect)(response.body).to.be.an(&#x27;array&#x27;);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;47a7a9ca-4430-4b36-8748-2e99b3e4c482&quot;,&quot;parentUUID&quot;:&quot;0f020892-adb8-4060-b149-120103cb1b50&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle adding configurations to profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should handle adding configurations to profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:24,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const configurations = [{ configId: &#x27;config1&#x27; }];\n    const response = yield (0, supertest_1.default)(app)\n        .post(&#x27;/api/profile/configurations&#x27;)\n        .send({ profileURI, configurations })\n        .expect(201);\n    sinon_1.default.assert.calledOnce(addConfigurationsToProfileSpy);\n    sinon_1.default.assert.calledWith(addConfigurationsToProfileSpy, profileURI, configurations);\n    (0, chai_1.expect)(response.body).to.have.property(&#x27;success&#x27;, true);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;c4b844e6-983b-4529-ba0f-83f0336fa7cb&quot;,&quot;parentUUID&quot;:&quot;0f020892-adb8-4060-b149-120103cb1b50&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle updating configurations for profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should handle updating configurations for profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:10,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const configurations = [{ configId: &#x27;config2&#x27; }];\n    const response = yield (0, supertest_1.default)(app)\n        .put(`/api/profile/${profileURI}/configurations`)\n        .send({ configurations })\n        .expect(200);\n    sinon_1.default.assert.calledOnce(updateConfigurationsForProfileSpy);\n    sinon_1.default.assert.calledWith(updateConfigurationsForProfileSpy, profileURI, configurations);\n    (0, chai_1.expect)(response.body).to.have.property(&#x27;success&#x27;, true);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;2082cd2f-707a-4cc1-b51f-4029b48c6664&quot;,&quot;parentUUID&quot;:&quot;0f020892-adb8-4060-b149-120103cb1b50&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false},{&quot;title&quot;:&quot;should handle deleting configurations from profile&quot;,&quot;fullTitle&quot;:&quot;ContractAgent Router Tests should handle deleting configurations from profile&quot;,&quot;timedOut&quot;:false,&quot;duration&quot;:8,&quot;state&quot;:&quot;passed&quot;,&quot;speed&quot;:&quot;fast&quot;,&quot;pass&quot;:true,&quot;fail&quot;:false,&quot;pending&quot;:false,&quot;context&quot;:null,&quot;code&quot;:&quot;return __awaiter(this, void 0, void 0, function* () {\n    const response = yield (0, supertest_1.default)(app)\n        .delete(`/api/profile/${profileURI}/configurations`)\n        .expect(200);\n    sinon_1.default.assert.calledOnce(removeConfigurationsFromProfileSpy);\n    sinon_1.default.assert.calledWith(removeConfigurationsFromProfileSpy, profileURI);\n    (0, chai_1.expect)(response.body).to.have.property(&#x27;success&#x27;, true);\n});&quot;,&quot;err&quot;:{},&quot;uuid&quot;:&quot;bc70ea24-8738-4557-bd0e-1ed58a4a87c2&quot;,&quot;parentUUID&quot;:&quot;0f020892-adb8-4060-b149-120103cb1b50&quot;,&quot;isHook&quot;:false,&quot;skipped&quot;:false}],&quot;suites&quot;:[],&quot;passes&quot;:[&quot;6b988895-9806-4979-8e7f-de24c98b231d&quot;,&quot;91677dfe-69be-4aa6-ab13-120fbd2701d8&quot;,&quot;47a7a9ca-4430-4b36-8748-2e99b3e4c482&quot;,&quot;c4b844e6-983b-4529-ba0f-83f0336fa7cb&quot;,&quot;2082cd2f-707a-4cc1-b51f-4029b48c6664&quot;,&quot;bc70ea24-8738-4557-bd0e-1ed58a4a87c2&quot;],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:89,&quot;root&quot;:false,&quot;rootEmpty&quot;:false,&quot;_timeout&quot;:4000}],&quot;passes&quot;:[],&quot;failures&quot;:[],&quot;pending&quot;:[],&quot;skipped&quot;:[],&quot;duration&quot;:0,&quot;root&quot;:true,&quot;rootEmpty&quot;:true,&quot;_timeout&quot;:4000}],&quot;meta&quot;:{&quot;mocha&quot;:{&quot;version&quot;:&quot;10.8.2&quot;},&quot;mochawesome&quot;:{&quot;options&quot;:{&quot;quiet&quot;:false,&quot;reportFilename&quot;:&quot;contract.agent.0.spec.ts&quot;,&quot;saveHtml&quot;:true,&quot;saveJson&quot;:true,&quot;consoleReporter&quot;:&quot;spec&quot;,&quot;useInlineDiffs&quot;:false,&quot;code&quot;:true},&quot;version&quot;:&quot;7.1.3&quot;},&quot;marge&quot;:{&quot;options&quot;:{&quot;reportDir&quot;:&quot;mochawesome-report/contract&quot;,&quot;reportFilename&quot;:&quot;contract.agent.0.spec.ts&quot;},&quot;version&quot;:&quot;6.2.0&quot;}}}" data-config="{&quot;reportFilename&quot;:&quot;report&quot;,&quot;reportDir&quot;:&quot;mochawesome-report\\contract&quot;,&quot;reportTitle&quot;:&quot;contract-agent&quot;,&quot;reportPageTitle&quot;:&quot;Mochawesome Report&quot;,&quot;inline&quot;:false,&quot;inlineAssets&quot;:false,&quot;cdn&quot;:false,&quot;charts&quot;:false,&quot;enableCharts&quot;:false,&quot;code&quot;:true,&quot;enableCode&quot;:true,&quot;autoOpen&quot;:false,&quot;overwrite&quot;:true,&quot;timestamp&quot;:false,&quot;ts&quot;:false,&quot;showPassed&quot;:true,&quot;showFailed&quot;:true,&quot;showPending&quot;:true,&quot;showSkipped&quot;:false,&quot;showHooks&quot;:&quot;failed&quot;,&quot;saveJson&quot;:false,&quot;saveHtml&quot;:true,&quot;dev&quot;:false,&quot;assetsDir&quot;:&quot;mochawesome-report\\contract\\assets&quot;,&quot;htmlFile&quot;:&quot;C:\\Users\\E\\Desktop\\visions\\dev\\cca-ptx\\contract-agent\\mochawesome-report\\contract\\report.html&quot;}"><div id="report"></div><script src="assets\app.js"></script></body></html>